<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ - ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7c3aed">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta property="og:title" content="íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ - ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©">
  <meta property="og:description" content="ë‹¹ì‹ ì˜ ë„ë•ì  ê¸°ì¤€ì€ ì–´ë””ê¹Œì§€ í”ë“¤ë¦´ê¹Œ?">
  <meta property="og:image" content="https://eclipse-mindlab.github.io/mindlab/og-image.png?v=2">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #09090b;
      color: #fff;
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px;
      min-height: 100vh;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }

    .back-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #18181b;
      border: 1px solid #27272a;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      text-decoration: none;
    }

    .header-title {
      font-size: 18px;
      font-weight: 600;
    }

    /* ì§„í–‰ ë°” */
    .progress-container {
      margin-bottom: 24px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #71717a;
      margin-bottom: 8px;
    }

    .progress-bar {
      height: 4px;
      background: #27272a;
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #7c3aed, #a78bfa);
      transition: width 0.5s ease;
    }

    /* ìŠ¤í…Œì´ì§€ í‘œì‹œ */
    .stage-badge {
      display: inline-block;
      padding: 6px 14px;
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(167, 139, 250, 0.1));
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: #a78bfa;
      margin-bottom: 16px;
    }

    /* ìƒí™© ì¹´ë“œ */
    .situation-card {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .situation-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      line-height: 1.4;
    }

    .situation-desc {
      font-size: 15px;
      color: #a1a1aa;
      line-height: 1.7;
      margin-bottom: 16px;
    }

    .situation-highlight {
      background: rgba(239, 68, 68, 0.1);
      border-left: 3px solid #ef4444;
      padding: 12px 16px;
      margin: 16px 0;
      font-size: 14px;
      color: #fca5a5;
      border-radius: 0 8px 8px 0;
    }

    .situation-new {
      background: rgba(251, 191, 36, 0.1);
      border-left: 3px solid #fbbf24;
      padding: 12px 16px;
      margin: 16px 0;
      font-size: 14px;
      color: #fcd34d;
      border-radius: 0 8px 8px 0;
    }

    /* ì„ íƒì§€ */
    .choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .choice-btn {
      padding: 18px 20px;
      background: #1f1f23;
      border: 2px solid #27272a;
      border-radius: 14px;
      color: #fff;
      font-size: 15px;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      line-height: 1.5;
    }

    .choice-btn:hover {
      border-color: #7c3aed;
      background: #252529;
    }

    .choice-btn:active {
      transform: scale(0.98);
    }

    .choice-label {
      display: inline-block;
      font-size: 12px;
      font-weight: 600;
      color: #a78bfa;
      margin-bottom: 4px;
    }

    /* ê²°ê³¼ í™”ë©´ */
    .result-screen {
      display: none;
      text-align: center;
      padding: 20px 0;
    }

    .result-card {
      background: linear-gradient(135deg, #18181b 0%, #1a1a2e 100%);
      border: 1px solid #27272a;
      border-radius: 20px;
      padding: 32px 24px;
      margin-bottom: 24px;
    }

    .result-icon {
      font-size: 56px;
      margin-bottom: 16px;
    }

    .result-type {
      font-size: 14px;
      color: #a78bfa;
      margin-bottom: 8px;
    }

    .result-title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #a78bfa, #f472b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .result-desc {
      font-size: 15px;
      color: #a1a1aa;
      line-height: 1.7;
      margin-bottom: 24px;
    }

    .result-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 24px;
    }

    .result-stat {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 16px;
    }

    .result-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #a78bfa;
    }

    .result-stat-label {
      font-size: 12px;
      color: #71717a;
    }

    /* ì„ íƒ ê¸°ë¡ */
    .choices-record {
      background: #18181b;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: left;
    }

    .choices-record-title {
      font-size: 14px;
      font-weight: 600;
      color: #a78bfa;
      margin-bottom: 16px;
    }

    .choice-record-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid #27272a;
    }

    .choice-record-item:last-child {
      border-bottom: none;
    }

    .choice-record-num {
      width: 24px;
      height: 24px;
      background: #27272a;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      flex-shrink: 0;
    }

    .choice-record-text {
      font-size: 13px;
      color: #a1a1aa;
    }

    .choice-record-answer {
      font-size: 13px;
      color: #fff;
      margin-top: 4px;
    }

    /* ì›ì¹™ ì¹´ë“œ */
    .principle-card {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(167, 139, 250, 0.05));
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: left;
    }

    .principle-label {
      font-size: 12px;
      color: #a78bfa;
      margin-bottom: 8px;
    }

    .principle-text {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      line-height: 1.5;
    }

    /* ì•¡ì…˜ ë²„íŠ¼ */
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .action-btn {
      padding: 16px;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      text-align: center;
      border: none;
    }

    .action-btn.primary {
      background: linear-gradient(135deg, #7c3aed, #a78bfa);
      color: #fff;
    }

    .action-btn.secondary {
      background: #27272a;
      color: #fff;
      border: 1px solid #3f3f46;
    }

    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">â†</a>
      <div class="header-title">íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ</div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen">
      <div class="progress-container">
        <div class="progress-label">
          <span id="stageLabel">STAGE 1</span>
          <span id="stageCount">1/5</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 20%"></div>
        </div>
      </div>

      <div class="stage-badge" id="stageBadge">STAGE 1: í´ë˜ì‹</div>

      <div class="situation-card">
        <div class="situation-title" id="situationTitle">ìƒí™© ì œëª©</div>
        <div class="situation-desc" id="situationDesc">ìƒí™© ì„¤ëª…</div>
        <div class="situation-highlight hidden" id="situationHighlight"></div>
        <div class="situation-new hidden" id="situationNew"></div>
      </div>

      <div class="choices" id="choicesContainer">
        <!-- ì„ íƒì§€ ë™ì  ìƒì„± -->
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="result-screen" id="resultScreen">
      <div class="result-card">
        <div class="result-icon" id="resultIcon">âš–ï¸</div>
        <div class="result-type">ë‹¹ì‹ ì˜ ë„ë• ìœ í˜•</div>
        <div class="result-title" id="resultTitle">ê³µë¦¬ì£¼ì˜ì</div>
        <div class="result-desc" id="resultDesc">ê²°ê³¼ ì„¤ëª…</div>
        <div class="result-stats">
          <div class="result-stat">
            <div class="result-stat-value" id="resultSaved">0</div>
            <div class="result-stat-label">êµ¬í•œ ìƒëª…</div>
          </div>
          <div class="result-stat">
            <div class="result-stat-value" id="resultSacrificed">0</div>
            <div class="result-stat-label">í¬ìƒì‹œí‚¨ ìƒëª…</div>
          </div>
        </div>
      </div>

      <div class="choices-record" id="choicesRecord">
        <div class="choices-record-title">ğŸ“‹ ë‹¹ì‹ ì˜ ì„ íƒ</div>
        <div id="choicesRecordList"></div>
      </div>

      <div class="principle-card">
        <div class="principle-label">ğŸ’ ë°œê²¬í•œ ì›ì¹™</div>
        <div class="principle-text" id="principleText">ì›ì¹™ í…ìŠ¤íŠ¸</div>
      </div>

      <div class="action-buttons">
        <button class="action-btn primary" id="shareBtn">ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
        <a href="index.html" class="action-btn secondary">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
      </div>
    </div>
  </div>

  <script>
    // ìŠ¤í…Œì´ì§€ ë°ì´í„°
    const STAGES = [
      {
        id: 1,
        badge: "STAGE 1: í´ë˜ì‹",
        title: "í­ì£¼í•˜ëŠ” íŠ¸ë¡¤ë¦¬",
        desc: "ë‹¹ì‹ ì€ ì„ ë¡œ ì˜†ì— ì„œ ìˆë‹¤. ë¸Œë ˆì´í¬ê°€ ê³ ì¥ë‚œ íŠ¸ë¡¤ë¦¬ê°€ ë‹¬ë ¤ì˜¤ê³  ìˆê³ , ì„ ë¡œ ìœ„ì—ëŠ” 5ëª…ì˜ ì¸ë¶€ê°€ ì¼í•˜ê³  ìˆë‹¤.\n\në‹¹ì‹  ì˜†ì—ëŠ” ë ˆë²„ê°€ ìˆë‹¤. ë ˆë²„ë¥¼ ë‹¹ê¸°ë©´ íŠ¸ë¡¤ë¦¬ê°€ ë‹¤ë¥¸ ì„ ë¡œë¡œ ë°”ë€Œì§€ë§Œ, ê·¸ ì„ ë¡œì—ëŠ” 1ëª…ì˜ ì¸ë¶€ê°€ ìˆë‹¤.",
        highlight: "5ëª…ì´ ì£½ê±°ë‚˜, 1ëª…ì´ ì£½ëŠ”ë‹¤.",
        newCondition: null,
        choices: [
          { id: "pull", text: "ë ˆë²„ë¥¼ ë‹¹ê¸´ë‹¤", subtext: "1ëª…ì„ í¬ìƒí•˜ê³  5ëª…ì„ êµ¬í•œë‹¤" },
          { id: "nothing", text: "ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤", subtext: "5ëª…ì´ ì£½ëŠ” ê²ƒì„ ì§€ì¼œë³¸ë‹¤" }
        ]
      },
      {
        id: 2,
        badge: "STAGE 2: ê°€ì¹˜ì˜ ë¬´ê²Œ",
        title: "íŠ¹ë³„í•œ 1ëª…",
        desc: "ê°™ì€ ìƒí™©ì´ë‹¤. í•˜ì§€ë§Œ ì´ë²ˆì—ëŠ” ë‹¤ë¥¸ ì„ ë¡œì— ìˆëŠ” 1ëª…ì´ ëˆ„êµ°ì§€ ì•Œê²Œ ë˜ì—ˆë‹¤.",
        highlight: "ê·¸ 1ëª…ì€ ìˆ˜ì²œ ëª…ì˜ ìƒëª…ì„ ì‚´ë¦´ ìˆ˜ ìˆëŠ” ì‹ ì•½ì„ ê°œë°œ ì¤‘ì¸ ì²œì¬ ì˜ì‚¬ë‹¤. ê·¸ê°€ ì£½ìœ¼ë©´ ì—°êµ¬ëŠ” ì¤‘ë‹¨ëœë‹¤.",
        newCondition: "âš¡ ìƒˆë¡œìš´ ì¡°ê±´: 1ëª…ì˜ ê°€ì¹˜ê°€ ë” ë†’ì•„ì¡Œë‹¤",
        choices: [
          { id: "pull", text: "ê·¸ë˜ë„ ë ˆë²„ë¥¼ ë‹¹ê¸´ë‹¤", subtext: "ì§€ê¸ˆ ë‹¹ì¥ì˜ 5ëª…ì„ êµ¬í•œë‹¤" },
          { id: "nothing", text: "ë ˆë²„ë¥¼ ë‹¹ê¸°ì§€ ì•ŠëŠ”ë‹¤", subtext: "ë¯¸ë˜ì˜ ìˆ˜ì²œ ëª…ì„ ìœ„í•´ 5ëª…ì„ í¬ìƒí•œë‹¤" }
        ]
      },
      {
        id: 3,
        badge: "STAGE 3: ë¶ˆì™„ì „í•œ ì •ë³´",
        title: "5ëª… ì¤‘ í•œ ëª…",
        desc: "ë‹¤ì‹œ ì²˜ìŒ ìƒí™©ìœ¼ë¡œ ëŒì•„ì™”ë‹¤. í•˜ì§€ë§Œ ì´ë²ˆì—” 5ëª…ì— ëŒ€í•œ ì •ë³´ê°€ ì£¼ì–´ì¡Œë‹¤.",
        highlight: "5ëª… ì¤‘ 1ëª…ì€ 3ëª…ì„ ì‚´í•´í•œ ì—°ì‡„ì‚´ì¸ë²”ì´ë‹¤. í•˜ì§€ë§Œ ëˆ„ê°€ ì‚´ì¸ë²”ì¸ì§€ëŠ” ëª¨ë¥¸ë‹¤.",
        newCondition: "âš¡ ìƒˆë¡œìš´ ì¡°ê±´: êµ¬í•  5ëª… ì¤‘ 1ëª…ì€ ì‚´ì¸ë²”",
        choices: [
          { id: "pull", text: "ë ˆë²„ë¥¼ ë‹¹ê¸´ë‹¤", subtext: "ì‚´ì¸ë²”ì´ í¬í•¨ë˜ì–´ ìˆì–´ë„ 4ëª…ì˜ ë¬´ê³ í•œ ì‚¬ëŒì„ êµ¬í•œë‹¤" },
          { id: "nothing", text: "ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤", subtext: "ì‚´ì¸ë²”ì„ êµ¬í•˜ëŠ” ê²ƒì´ ë  ìˆ˜ë„ ìˆë‹¤" }
        ]
      },
      {
        id: 4,
        badge: "STAGE 4: ê°œì¸ì  ê´€ê³„",
        title: "ì„ ë¡œ ìœ„ì˜ ê°€ì¡±",
        desc: "ì´ë²ˆì—ëŠ” ìƒí™©ì´ ì™„ì „íˆ ë‹¬ë¼ì¡Œë‹¤.",
        highlight: "ë‹¤ë¥¸ ì„ ë¡œì— ìˆëŠ” 1ëª…ì´ ë‹¹ì‹ ì˜ ë¶€ëª¨/ìë…€/ë°°ìš°ì ì¤‘ í•œ ëª…ì´ë‹¤. 5ëª…ì€ ëª¨ë‘ ë‚¯ì„  ì‚¬ëŒì´ë‹¤.",
        newCondition: "âš¡ ìƒˆë¡œìš´ ì¡°ê±´: 1ëª…ì´ ë‹¹ì‹ ì˜ ê°€ì¡±",
        choices: [
          { id: "pull", text: "ê·¸ë˜ë„ ë ˆë²„ë¥¼ ë‹¹ê¸´ë‹¤", subtext: "ê°€ì¡±ì„ í¬ìƒí•˜ê³  5ëª…ì„ êµ¬í•œë‹¤" },
          { id: "nothing", text: "ë ˆë²„ë¥¼ ë‹¹ê¸°ì§€ ì•ŠëŠ”ë‹¤", subtext: "5ëª…ì´ ì£½ë”ë¼ë„ ê°€ì¡±ì„ ì§€í‚¨ë‹¤" }
        ]
      },
      {
        id: 5,
        badge: "STAGE 5: ì§ì ‘ì  í–‰ìœ„",
        title: "ë‹¤ë¦¬ ìœ„ì˜ ë‚¨ì",
        desc: "ë” ì´ìƒ ë ˆë²„ëŠ” ì—†ë‹¤. ë‹¹ì‹ ì€ ë‹¤ë¦¬ ìœ„ì— ì„œ ìˆê³ , ì˜†ì— ë©ì¹˜ í° ë‚¨ìê°€ ìˆë‹¤.\n\nì´ ë‚¨ìë¥¼ ë‹¤ë¦¬ ì•„ë˜ë¡œ ë°€ë©´ ê·¸ì˜ ëª¸ì´ íŠ¸ë¡¤ë¦¬ë¥¼ ë©ˆì¶œ ìˆ˜ ìˆë‹¤. ë‹¹ì‹ ì´ ì§ì ‘ ë›°ì–´ë‚´ë ¤ë„ ëª¸ì´ ê°€ë²¼ì›Œì„œ íŠ¸ë¡¤ë¦¬ë¥¼ ë©ˆì¶œ ìˆ˜ ì—†ë‹¤.",
        highlight: "ë ˆë²„ë¥¼ ë‹¹ê¸°ëŠ” ê²ƒê³¼ ì§ì ‘ ë°€ì–´ì„œ ì£½ì´ëŠ” ê²ƒ. ê²°ê³¼ëŠ” ê°™ì§€ë§Œ í–‰ìœ„ëŠ” ë‹¤ë¥´ë‹¤.",
        newCondition: "âš¡ ìƒˆë¡œìš´ ì¡°ê±´: ë ˆë²„ê°€ ì•„ë‹ˆë¼ ì§ì ‘ ë°€ì–´ì•¼ í•œë‹¤",
        choices: [
          { id: "push", text: "ë‚¨ìë¥¼ ë¯¼ë‹¤", subtext: "ì§ì ‘ ì†ìœ¼ë¡œ 1ëª…ì„ ì£½ì´ê³  5ëª…ì„ êµ¬í•œë‹¤" },
          { id: "nothing", text: "ë°€ì§€ ì•ŠëŠ”ë‹¤", subtext: "ì§ì ‘ì ì¸ ì‚´ì¸ì€ í•  ìˆ˜ ì—†ë‹¤" }
        ]
      }
    ];

    // ë„ë• ìœ í˜• ì •ì˜
    const MORAL_TYPES = {
      utilitarian: {
        icon: "ğŸ“Š",
        title: "ê³µë¦¬ì£¼ì˜ì",
        desc: "ë‹¹ì‹ ì€ ê²°ê³¼ë¥¼ ì¤‘ì‹œí•©ë‹ˆë‹¤. 'ìµœëŒ€ ë‹¤ìˆ˜ì˜ ìµœëŒ€ í–‰ë³µ'ì´ ë‹¹ì‹ ì˜ ê¸°ì¤€ì…ë‹ˆë‹¤. ìˆ«ìë¡œ ê³„ì‚°í•  ìˆ˜ ìˆëŠ” ê²ƒ, ì¸¡ì • ê°€ëŠ¥í•œ ê²°ê³¼ê°€ ì˜³ê³  ê·¸ë¦„ì˜ ê¸°ì¤€ì´ ë©ë‹ˆë‹¤.\n\nì´ê²ƒì€ ëƒ‰ì •í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ê°ì •ì— íœ˜ë‘˜ë¦¬ì§€ ì•ŠëŠ” í•©ë¦¬ì  íŒë‹¨ì´ê¸°ë„ í•©ë‹ˆë‹¤.",
        principle: "ë„ë•ì  ì„ íƒì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ ê²°ê³¼ë‹¤. ë” ë§ì€ ìƒëª…ì„ êµ¬í•˜ëŠ” ì„ íƒì´ ì˜³ë‹¤."
      },
      deontologist: {
        icon: "ğŸ“œ",
        title: "ì˜ë¬´ë¡ ì",
        desc: "ë‹¹ì‹ ì€ í–‰ìœ„ ìì²´ì˜ ì˜³ê³  ê·¸ë¦„ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤. ì•„ë¬´ë¦¬ ì¢‹ì€ ê²°ê³¼ë¥¼ ìœ„í•´ì„œë¼ë„ 'í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ'ì´ ìˆë‹¤ê³  ë¯¿ìŠµë‹ˆë‹¤.\n\n'ëª©ì ì´ ìˆ˜ë‹¨ì„ ì •ë‹¹í™”í•˜ì§€ ì•ŠëŠ”ë‹¤'ëŠ” ì¹¸íŠ¸ì˜ ë§ì´ ë‹¹ì‹ ì˜ ì² í•™ì…ë‹ˆë‹¤.",
        principle: "ì¸ê°„ì„ ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©í•´ì„œëŠ” ì•ˆ ëœë‹¤. ì–´ë–¤ ê²°ê³¼ë¥¼ ìœ„í•´ ë¬´ê³ í•œ ìƒëª…ì„ í¬ìƒì‹œí‚¤ëŠ” ê²ƒì€ ê·¸ ìì²´ë¡œ ì˜ëª»ì´ë‹¤."
      },
      relativist: {
        icon: "ğŸ”„",
        title: "ê´€ê³„ì£¼ì˜ì",
        desc: "ë‹¹ì‹ ì—ê²ŒëŠ” ëª¨ë“  ìƒëª…ì´ ë™ë“±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°€ì¡±, ì¹œêµ¬, ë‚¯ì„  ì‚¬ëŒ - ê´€ê³„ì— ë”°ë¼ ë„ë•ì  ì˜ë¬´ë„ ë‹¬ë¼ì§„ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.\n\nì´ê²ƒì€ 'ë¶ˆê³µí‰'ì´ ì•„ë‹ˆë¼ ì¸ê°„ ë³¸ì„±ì— ì¶©ì‹¤í•œ ê²ƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        principle: "ê°€ê¹Œìš´ ì‚¬ëŒì— ëŒ€í•œ íŠ¹ë³„í•œ ì˜ë¬´ê°€ ìˆë‹¤. ë‚´ ê°€ì¡±ì„ ë‚¯ì„  5ëª…ë³´ë‹¤ ìš°ì„ ì‹œí•˜ëŠ” ê²ƒì€ ìì—°ìŠ¤ëŸ¬ìš´ ì¼ì´ë‹¤."
      },
      situationist: {
        icon: "ğŸ­",
        title: "ìƒí™©ì£¼ì˜ì",
        desc: "ë‹¹ì‹ ì€ ê³ ì •ëœ ì›ì¹™ë³´ë‹¤ ìƒí™©ì˜ ë§¥ë½ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤. ê°™ì€ '5ëª… vs 1ëª…'ë„ ëˆ„ê°€ ê´€ë ¨ë˜ì–´ ìˆëŠ”ì§€, ì–´ë–¤ í–‰ìœ„ê°€ í•„ìš”í•œì§€ì— ë”°ë¼ íŒë‹¨ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\n\nì´ê²ƒì€ ìœ ì—°í•¨ì´ì, ë™ì‹œì— ê¸°ì¤€ì˜ ë¶€ì¬ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        principle: "ë„ë•ì  íŒë‹¨ì— ì ˆëŒ€ì  ê¸°ì¤€ì€ ì—†ë‹¤. ìƒí™©ê³¼ ë§¥ë½ì— ë”°ë¼ ì˜³ì€ ì„ íƒì´ ë‹¬ë¼ì§„ë‹¤."
      }
    };

    // ìƒíƒœ
    let currentStage = 0;
    let choices = [];
    let savedLives = 0;
    let sacrificedLives = 0;

    // DOM
    const gameScreen = document.getElementById('gameScreen');
    const resultScreen = document.getElementById('resultScreen');
    const stageLabel = document.getElementById('stageLabel');
    const stageCount = document.getElementById('stageCount');
    const progressFill = document.getElementById('progressFill');
    const stageBadge = document.getElementById('stageBadge');
    const situationTitle = document.getElementById('situationTitle');
    const situationDesc = document.getElementById('situationDesc');
    const situationHighlight = document.getElementById('situationHighlight');
    const situationNew = document.getElementById('situationNew');
    const choicesContainer = document.getElementById('choicesContainer');

    function init() {
      showStage(0);
    }

    function showStage(index) {
      const stage = STAGES[index];
      
      stageLabel.textContent = `STAGE ${stage.id}`;
      stageCount.textContent = `${stage.id}/5`;
      progressFill.style.width = `${(stage.id / 5) * 100}%`;
      stageBadge.textContent = stage.badge;
      
      situationTitle.textContent = stage.title;
      situationDesc.innerHTML = stage.desc.replace(/\n/g, '<br>');
      
      if (stage.highlight) {
        situationHighlight.innerHTML = stage.highlight;
        situationHighlight.classList.remove('hidden');
      } else {
        situationHighlight.classList.add('hidden');
      }
      
      if (stage.newCondition) {
        situationNew.innerHTML = stage.newCondition;
        situationNew.classList.remove('hidden');
      } else {
        situationNew.classList.add('hidden');
      }
      
      // ì„ íƒì§€ ìƒì„±
      choicesContainer.innerHTML = stage.choices.map((choice, idx) => `
        <button class="choice-btn" onclick="selectChoice('${choice.id}', ${index})">
          <div class="choice-label">${idx === 0 ? 'A' : 'B'}</div>
          <div>${choice.text}</div>
          <div style="font-size: 13px; color: #71717a; margin-top: 4px;">${choice.subtext}</div>
        </button>
      `).join('');
    }

    function selectChoice(choiceId, stageIndex) {
      const stage = STAGES[stageIndex];
      const choice = stage.choices.find(c => c.id === choiceId);
      
      // ì„ íƒ ê¸°ë¡
      choices.push({
        stage: stage.id,
        title: stage.title,
        choice: choice.text,
        choiceId: choiceId
      });
      
      // ìƒëª… ê³„ì‚°
      if (choiceId === 'pull' || choiceId === 'push') {
        savedLives += 5;
        sacrificedLives += 1;
      } else {
        sacrificedLives += 5;
      }
      
      // ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ë˜ëŠ” ê²°ê³¼
      if (stageIndex < STAGES.length - 1) {
        currentStage = stageIndex + 1;
        showStage(currentStage);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        showResult();
      }
    }

    function calculateMoralType() {
      // ì„ íƒ íŒ¨í„´ ë¶„ì„
      const pullCount = choices.filter(c => c.choiceId === 'pull' || c.choiceId === 'push').length;
      const nothingCount = choices.filter(c => c.choiceId === 'nothing').length;
      
      // Stage 4 (ê°€ì¡±) ì„ íƒ
      const familyChoice = choices.find(c => c.stage === 4);
      const savedFamily = familyChoice && familyChoice.choiceId === 'nothing';
      
      // Stage 5 (ì§ì ‘ ë°€ê¸°) ì„ íƒ
      const pushChoice = choices.find(c => c.stage === 5);
      const pushedDirectly = pushChoice && pushChoice.choiceId === 'push';
      
      // ë„ë• ìœ í˜• íŒì •
      if (pullCount >= 4 && pushedDirectly) {
        return 'utilitarian'; // ê±°ì˜ ëª¨ë“  ìƒí™©ì—ì„œ ë‹¤ìˆ˜ êµ¬í•¨ + ì§ì ‘ ë°€ê¸°ë„ í•¨
      } else if (nothingCount >= 4 || (!pushedDirectly && nothingCount >= 2)) {
        return 'deontologist'; // ëŒ€ë¶€ë¶„ ê°œì… ì•ˆ í•¨ ë˜ëŠ” ì§ì ‘ í–‰ìœ„ ê±°ë¶€
      } else if (savedFamily && pullCount >= 2) {
        return 'relativist'; // ê°€ì¡±ì€ êµ¬í•˜ë©´ì„œ ë‹¤ë¥¸ ê±´ ê³µë¦¬ì  íŒë‹¨
      } else {
        return 'situationist'; // ì¼ê´€ì„± ì—†ì´ ìƒí™©ë§ˆë‹¤ ë‹¤ë¥¸ ì„ íƒ
      }
    }

    function showResult() {
      gameScreen.style.display = 'none';
      resultScreen.style.display = 'block';
      
      const typeKey = calculateMoralType();
      const type = MORAL_TYPES[typeKey];
      
      document.getElementById('resultIcon').textContent = type.icon;
      document.getElementById('resultTitle').textContent = type.title;
      document.getElementById('resultDesc').textContent = type.desc;
      document.getElementById('resultSaved').textContent = savedLives;
      document.getElementById('resultSacrificed').textContent = sacrificedLives;
      document.getElementById('principleText').textContent = type.principle;
      
      // ì„ íƒ ê¸°ë¡
      const recordHtml = choices.map(c => `
        <div class="choice-record-item">
          <div class="choice-record-num">${c.stage}</div>
          <div>
            <div class="choice-record-text">${c.title}</div>
            <div class="choice-record-answer">â†’ ${c.choice}</div>
          </div>
        </div>
      `).join('');
      document.getElementById('choicesRecordList').innerHTML = recordHtml;
      
      // í”„ë¡œí•„ì— ì €ì¥
      saveProgress(typeKey, type.principle);
      
      // ê³µìœ  ë²„íŠ¼
      document.getElementById('shareBtn').addEventListener('click', async () => {
        const text = `ğŸšƒ íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ ê²°ê³¼\n\në‚˜ì˜ ë„ë• ìœ í˜•: ${type.title}\n\nêµ¬í•œ ìƒëª…: ${savedLives}ëª…\ní¬ìƒì‹œí‚¨ ìƒëª…: ${sacrificedLives}ëª…\n\n"${type.principle}"\n\nhttps://eclipse-mindlab.github.io/mindlab/sim-trolley.html`;
        
        // ëª¨ë°”ì¼ì—ì„œë§Œ ë„¤ì´í‹°ë¸Œ ê³µìœ  ì‚¬ìš©
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        if (isMobile && navigator.share) {
          try {
            await navigator.share({ title: 'íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ', text: text });
          } catch (e) {
            // ê³µìœ  ì·¨ì†Œì‹œ ë¬´ì‹œ
          }
        } else {
          try {
            await navigator.clipboard.writeText(text);
            alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
          } catch (e) {
            // fallback
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
          }
        }
      });
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function saveProgress(typeKey, principle) {
      const saved = localStorage.getItem('eclipse_mindlab_profile');
      if (!saved) return;
      
      const profile = JSON.parse(saved);
      
      // ì™„ë£Œ ê¸°ë¡
      if (!profile.completedSims) profile.completedSims = [];
      if (!profile.completedSims.includes('trolley')) {
        profile.completedSims.push('trolley');
        profile.exp = (profile.exp || 0) + 30;
      }
      
      // ì›ì¹™ ì €ì¥
      if (!profile.principles) profile.principles = [];
      if (!profile.principles.includes(principle)) {
        profile.principles.push(principle);
      }
      
      // ë ˆë²¨ì—… ì²´í¬
      const expNeeded = profile.level * 100;
      while (profile.exp >= expNeeded) {
        profile.exp -= expNeeded;
        profile.level++;
      }
      
      localStorage.setItem('eclipse_mindlab_profile', JSON.stringify(profile));
    }

    init();
  </script>
</body>
</html>
