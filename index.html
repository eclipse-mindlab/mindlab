<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7c3aed">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ë§ˆì¸ë“œë©">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <!-- SEO -->
  <meta name="description" content="ë‹¹ì‹ ì˜ ë„ë• ì„±í–¥ì„ ì•Œì•„ë³´ì„¸ìš”. ì‹¬ë¦¬, ì² í•™, ì‚¬íšŒì˜ ìˆ¨ê²¨ì§„ ì›ì¹™ë“¤ì„ ë°œê²¬í•˜ëŠ” ì§€ì  íƒí—˜.">
  <meta property="og:title" content="ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë© - ë‹¹ì‹ ì˜ ë„ë• ì„±í–¥ì€?">
  <meta property="og:description" content="ë§¤ì¼ ìƒˆë¡œìš´ ë”œë ˆë§ˆì— ë‹µí•˜ê³ , ë‚˜ì™€ ë¹„ìŠ·í•œ ì² í•™ìë¥¼ ì°¾ì•„ë³´ì„¸ìš”.">
  <meta property="og:image" content="https://eclipse-mindlab.github.io/mindlab/og-image.png">
  <meta property="og:url" content="https://eclipse-mindlab.github.io/mindlab/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë© - ë‹¹ì‹ ì˜ ë„ë• ì„±í–¥ì€?">
  <meta name="twitter:description" content="ë§¤ì¼ ìƒˆë¡œìš´ ë”œë ˆë§ˆì— ë‹µí•˜ê³ , ë‚˜ì™€ ë¹„ìŠ·í•œ ì² í•™ìë¥¼ ì°¾ì•„ë³´ì„¸ìš”.">
  <meta name="twitter:image" content="https://eclipse-mindlab.github.io/mindlab/og-image.png">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #09090b;
      color: #fff;
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container { max-width: 480px; margin: 0 auto; padding: 24px 16px; }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-logo { width: 36px; height: 36px; border-radius: 50%; }
    .brand-text { font-size: 18px; font-weight: 600; color: #a78bfa; }
    
    .beta-badge {
      font-size: 10px;
      padding: 2px 6px;
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
      border-radius: 4px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .header-links { display: flex; gap: 12px; }
    .header-link { color: #71717a; text-decoration: none; font-size: 13px; }
    .header-link:hover { color: #a78bfa; }

    .profile-card {
      background: linear-gradient(135deg, #18181b 0%, #1f1f23 100%);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid #27272a;
      position: relative;
    }

    .google-sync-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #27272a;
      border: 1px solid #3f3f46;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .google-sync-btn:hover {
      background: #3f3f46;
      transform: scale(1.05);
    }

    .google-sync-btn.synced {
      background: #166534;
      border-color: #22c55e;
    }

    .google-sync-btn.synced svg {
      display: none;
    }

    .google-sync-btn.synced::after {
      content: 'âœ“';
      color: #fff;
      font-size: 16px;
    }

    .profile-top { display: flex; gap: 16px; margin-bottom: 16px; }

    .tier-badge { 
      width: 72px; 
      flex-shrink: 0; 
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .tier-badge img { width: 72px; height: 72px; border-radius: 50%; object-fit: cover; }
    .tier-label {
      font-size: 12px;
      font-weight: 600;
      padding: 2px 10px;
      border-radius: 10px;
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .profile-info { flex: 1; }
    .profile-name { font-size: 20px; font-weight: 600; margin-bottom: 2px; }
    .profile-title { font-size: 13px; color: #a78bfa; margin-bottom: 8px; }

    .level-info { display: flex; align-items: center; gap: 8px; }
    .level-text { font-size: 12px; color: #71717a; }
    .level-num { color: #fff; font-weight: 600; }
    .exp-bar { flex: 1; height: 6px; background: #27272a; border-radius: 3px; overflow: hidden; }
    .exp-fill { height: 100%; background: linear-gradient(90deg, #a78bfa, #c084fc); border-radius: 3px; }
    .exp-text { font-size: 11px; color: #71717a; }

    .journey-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid #27272a; }
    .journey-title { font-size: 13px; color: #71717a; margin-bottom: 12px; }
    .journey-stats { display: flex; gap: 16px; }
    .journey-stat { flex: 1; text-align: center; padding: 12px; background: #1f1f23; border-radius: 10px; }
    .journey-stat-value { font-size: 20px; font-weight: 700; }
    .journey-stat-label { font-size: 11px; color: #71717a; }

    .save-profile-btn {
      width: 100%;
      margin-top: 16px;
      padding: 14px;
      background: linear-gradient(135deg, #7c3aed, #a78bfa);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .save-profile-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .save-profile-btn.success {
      background: #166534;
    }

    .install-btn {
      width: 100%;
      margin-top: 16px;
      padding: 14px;
      background: linear-gradient(135deg, #7c3aed, #5b21b6);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .install-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .install-btn.hidden { display: none; }

    .share-app-btn {
      width: 100%;
      margin-top: 10px;
      padding: 14px;
      background: #27272a;
      border: 1px solid #3f3f46;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .share-app-btn:hover {
      background: #3f3f46;
    }

    .share-app-btn.success {
      background: #166534;
      border-color: #22c55e;
    }

    .daily-banner {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(124, 58, 237, 0.1));
      border: 1px solid rgba(167, 139, 250, 0.3);
      border-radius: 14px;
      margin-bottom: 24px;
      text-decoration: none;
      color: #fff;
      transition: all 0.2s;
    }

    .daily-banner:hover {
      border-color: #a78bfa;
      transform: translateY(-2px);
    }

    .daily-icon { font-size: 28px; }
    .daily-content { flex: 1; }
    .daily-title { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
    .daily-desc { font-size: 12px; color: #a78bfa; }
    .daily-arrow { font-size: 18px; color: #71717a; }

    .map-section { margin-bottom: 24px; }
    .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .section-title { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
    .section-title .icon { font-size: 20px; }
    .section-progress { font-size: 13px; color: #71717a; }

    .category-card {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 16px;
      padding: 12px;
    }

    .sim-list { display: flex; flex-direction: column; gap: 8px; }

    .sim-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #1f1f23;
      border-radius: 10px;
      text-decoration: none;
      color: #fff;
      transition: all 0.2s;
    }

    .sim-item:hover { background: #27272a; }
    .sim-item.locked { opacity: 0.5; pointer-events: none; }
    .sim-item.completed { border-left: 3px solid #4ade80; }

    .sim-status { width: 24px; text-align: center; font-size: 14px; }
    .sim-info { flex: 1; }
    .sim-title { font-size: 14px; font-weight: 500; }
    .sim-desc { font-size: 12px; color: #71717a; }
    .sim-reward { font-size: 11px; color: #a78bfa; }

    /* ì›ì¹™ ë„ê° ë§í¬ */
    .dex-link {
      display: block;
      background: linear-gradient(135deg, #18181b 0%, #1f1f23 100%);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid #27272a;
      text-decoration: none;
      color: #fff;
      transition: all 0.2s;
    }

    .dex-link:hover {
      border-color: #7c3aed;
      transform: translateY(-2px);
    }

    .dex-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .dex-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dex-count {
      font-size: 14px;
      color: #a78bfa;
      font-weight: 600;
    }

    .dex-progress {
      height: 8px;
      background: #27272a;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .dex-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #7c3aed, #a78bfa);
      border-radius: 4px;
      transition: width 0.3s;
    }

    .dex-subtitle {
      font-size: 12px;
      color: #71717a;
    }

    .tier-section { background: #18181b; border-radius: 16px; padding: 20px; margin-bottom: 24px; }
    .tier-progress { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; }
    .tier-item { display: flex; flex-direction: column; align-items: center; gap: 6px; }
    .tier-icon { width: 32px; height: 32px; border-radius: 50%; overflow: hidden; opacity: 0.3; }
    .tier-icon.active { opacity: 1; box-shadow: 0 0 12px rgba(167, 139, 250, 0.5); }
    .tier-icon.completed { opacity: 0.7; }
    .tier-icon img { width: 100%; height: 100%; object-fit: cover; }
    .tier-name { font-size: 10px; color: #52525b; }
    .tier-item.active .tier-name { color: #a78bfa; font-weight: 600; }

    .book-section { margin-bottom: 24px; }
    
    /* ì´í´ë¦½ìŠ¤ ë” ì•Œì•„ë³´ê¸° ì„¹ì…˜ */
    .eclipse-section {
      text-align: center;
      padding: 24px 0;
      border-top: 1px solid #27272a;
      margin-bottom: 24px;
    }
    
    .eclipse-section-title {
      font-size: 14px;
      color: #71717a;
      margin-bottom: 16px;
    }
    
    .youtube-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 14px 32px;
      background: #27272a;
      border: 1px solid #3f3f46;
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .youtube-btn:hover {
      background: #3f3f46;
      transform: translateY(-2px);
    }
    
    .youtube-btn svg {
      fill: #ff0000;
    }
    
    /* ì±… ì„¹ì…˜ */
    .books-section {
      text-align: center;
      padding-top: 24px;
      border-top: 1px solid #27272a;
      margin-bottom: 24px;
    }
    
    .books-section-title {
      font-size: 14px;
      color: #71717a;
      margin-bottom: 20px;
    }
    
    .books-grid {
      display: flex;
      gap: 16px;
      justify-content: center;
    }
    
    .book-item {
      flex: 1;
      max-width: 160px;
      text-decoration: none;
      color: #fff;
      transition: all 0.2s;
    }
    
    .book-item:hover {
      transform: translateY(-4px);
    }
    
    .book-item img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      margin-bottom: 10px;
    }
    
    .book-item-title {
      font-size: 13px;
      color: #a1a1aa;
    }
    
    .book-card {
      display: flex;
      align-items: center;
      gap: 16px;
      background: linear-gradient(135deg, #1a1520 0%, #18181b 100%);
      border: 1px solid #2d2438;
      border-radius: 16px;
      padding: 16px;
      text-decoration: none;
      color: #fff;
      transition: all 0.2s;
    }
    
    .book-card:hover {
      border-color: #a78bfa;
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(167, 139, 250, 0.15);
    }
    
    .book-images {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
    
    .book-img {
      width: 56px;
      height: auto;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }
    
    .book-info { flex: 1; }
    .book-series { font-size: 11px; color: #a78bfa; margin-bottom: 4px; }
    .book-main-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .book-desc { font-size: 12px; color: #71717a; }

    .footer { text-align: center; padding: 24px 0; border-top: 1px solid #27272a; }
    .footer-links { display: flex; justify-content: center; gap: 24px; margin-bottom: 16px; }
    .footer-link { display: flex; align-items: center; gap: 6px; color: #71717a; text-decoration: none; font-size: 13px; }
    .footer-link:hover { color: #a78bfa; }
    .footer-copy { font-size: 11px; color: #52525b; }

    .modal-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex; align-items: center; justify-content: center;
      z-index: 100; padding: 20px;
    }
    .modal-overlay.hidden { display: none; }
    .modal {
      background: #18181b; border-radius: 20px;
      padding: 32px 24px; max-width: 360px; width: 100%; text-align: center;
    }
    .modal-logo { width: 64px; height: 64px; border-radius: 50%; margin-bottom: 16px; }
    .modal-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
    .modal-desc { font-size: 14px; color: #71717a; margin-bottom: 24px; line-height: 1.6; }
    .modal-input {
      width: 100%; padding: 14px 16px;
      background: #27272a; border: 1px solid #3f3f46; border-radius: 12px;
      color: #fff; font-size: 16px; margin-bottom: 16px; text-align: center;
    }
    .modal-input:focus { outline: none; border-color: #7c3aed; }
    .modal-btn {
      width: 100%; padding: 14px;
      background: #7c3aed; border: none; border-radius: 12px;
      color: #fff; font-size: 16px; font-weight: 600; cursor: pointer;
    }
    .modal-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="modal-overlay" id="nameModal">
    <div class="modal">
      <img src="logo.png" alt="ì´í´ë¦½ìŠ¤" class="modal-logo">
      <div class="modal-title">ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©</div>
      <div class="modal-desc">ì§€ì  íƒí—˜ì„ ì‹œì‘í•˜ì„¸ìš”.<br>ì‹¬ë¦¬, ì² í•™, ì‚¬íšŒì˜ ìˆ¨ê²¨ì§„ ì›ì¹™ë“¤ì„ ë°œê²¬í•©ë‹ˆë‹¤.</div>
      <input type="text" class="modal-input" id="nameInput" placeholder="íƒí—˜ê°€ ì´ë¦„" maxlength="12">
      <button class="modal-btn" id="startBtn" disabled>íƒí—˜ ì‹œì‘</button>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="brand">
        <img src="logo.png" alt="ì´í´ë¦½ìŠ¤" class="brand-logo">
        <span class="brand-text">ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©</span>
        <span class="beta-badge">BETA</span>
      </div>
      <div class="header-links">
        <a href="https://www.youtube.com/@Eclipse-g4e" target="_blank" class="header-link">ìœ íŠœë¸Œ</a>
        <a href="https://litt.ly/eclipse.thinker" target="_blank" class="header-link">ì±…</a>
      </div>
    </div>

    <div class="profile-card">
      <button class="google-sync-btn" id="googleSyncBtn" title="êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë°±ì—…">
        <svg width="18" height="18" viewBox="0 0 24 24">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
      </button>
      <div class="profile-top">
        <div class="tier-badge">
          <img src="tier-ruby.png" alt="í‹°ì–´" id="tierImage">
          <span class="tier-label" id="tierLabel">ë£¨ë¹„</span>
        </div>
        <div class="profile-info">
          <div class="profile-name" id="profileName">íƒí—˜ê°€</div>
          <div class="profile-title" id="profileTitle">ğŸŒ± ì´ˆë³´ íƒí—˜ê°€</div>
          <div class="level-info">
            <span class="level-text">Lv.<span class="level-num" id="levelNum">1</span></span>
            <div class="exp-bar">
              <div class="exp-fill" id="expFill" style="width: 0%"></div>
            </div>
            <span class="exp-text" id="expText">0/100</span>
          </div>
        </div>
      </div>
      <div class="journey-section">
        <div class="journey-title">íƒí—˜ í˜„í™©</div>
        <div class="journey-stats">
          <div class="journey-stat">
            <div class="journey-stat-value" id="statCleared">0</div>
            <div class="journey-stat-label">í´ë¦¬ì–´</div>
          </div>
          <div class="journey-stat">
            <div class="journey-stat-value" id="statPrinciples">0</div>
            <div class="journey-stat-label">ë°œê²¬í•œ ì›ì¹™</div>
          </div>
        </div>
      </div>

      <button class="save-profile-btn" id="saveProfileBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
        í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥
      </button>

      <button class="install-btn hidden" id="installBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°
      </button>

      <button class="share-app-btn" id="shareAppBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
        </svg>
        ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°
      </button>
    </div>

    <a href="daily.html" class="daily-banner">
      <div class="daily-icon">ğŸ¤”</div>
      <div class="daily-content">
        <div class="daily-title">ì˜¤ëŠ˜ì˜ ë”œë ˆë§ˆ</div>
        <div class="daily-desc">ë§¤ì¼ ìƒˆë¡œìš´ ì§ˆë¬¸ì— ë‹µí•˜ê³  +10 EXP</div>
      </div>
      <div class="daily-arrow">â†’</div>
    </a>

    <div class="map-section">
      <div class="section-header">
        <div class="section-title"><span class="icon">ğŸ’­</span> ì² í•™ ì‹œë®¬ë ˆì´í„°</div>
        <div class="section-progress" id="philProgress">0/2</div>
      </div>
      <div class="category-card">
        <div class="sim-list" id="philList"></div>
      </div>
    </div>

    <div class="map-section">
      <div class="section-header">
        <div class="section-title"><span class="icon">ğŸ§ </span> ì‹¬ë¦¬ ì‹œë®¬ë ˆì´í„°</div>
        <div class="section-progress" id="psychProgress">0/5</div>
      </div>
      <div class="category-card">
        <div class="sim-list" id="psychList"></div>
      </div>
    </div>

    <div class="map-section">
      <div class="section-header">
        <div class="section-title"><span class="icon">ğŸ”¬</span> ì‚¬íšŒ ì‹œë®¬ë ˆì´í„°</div>
        <div class="section-progress">0/2</div>
      </div>
      <div class="category-card">
        <div class="sim-list">
          <div class="sim-item locked">
            <div class="sim-status">ğŸ”’</div>
            <div class="sim-info">
              <div class="sim-title">ì£„ìˆ˜ì˜ ë”œë ˆë§ˆ</div>
              <div class="sim-desc">Coming Soon</div>
            </div>
          </div>
          <div class="sim-item locked">
            <div class="sim-status">ğŸ”’</div>
            <div class="sim-info">
              <div class="sim-title">ë°©ê´€ì íš¨ê³¼</div>
              <div class="sim-desc">Coming Soon</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <a href="dex.html" class="dex-link">
      <div class="dex-header">
        <div class="dex-title"><span class="icon">ğŸ’</span> ì›ì¹™ ë„ê°</div>
        <div class="dex-count" id="dexCount">0/80</div>
      </div>
      <div class="dex-progress">
        <div class="dex-progress-fill" id="dexProgressFill" style="width: 0%"></div>
      </div>
      <div class="dex-subtitle">ì‹œë®¬ë ˆì´í„°ë¥¼ í´ë¦¬ì–´í•˜ë©° ì›ì¹™ì„ ìˆ˜ì§‘í•˜ì„¸ìš” â†’</div>
    </a>

    <div class="tier-section">
      <div class="section-title">í‹°ì–´ ì§„í–‰ë„</div>
      <div class="tier-progress">
        <div class="tier-item active" data-tier="ruby">
          <div class="tier-icon active"><img src="tier-ruby.png"></div>
          <span class="tier-name">ë£¨ë¹„</span>
        </div>
        <div class="tier-item" data-tier="amethyst">
          <div class="tier-icon"><img src="tier-amethyst.png"></div>
          <span class="tier-name">ììˆ˜ì •</span>
        </div>
        <div class="tier-item" data-tier="sapphire">
          <div class="tier-icon"><img src="tier-sapphire.png"></div>
          <span class="tier-name">ì‚¬íŒŒì´ì–´</span>
        </div>
        <div class="tier-item" data-tier="emerald">
          <div class="tier-icon"><img src="tier-emerald.png"></div>
          <span class="tier-name">ì—ë©”ë„ë“œ</span>
        </div>
        <div class="tier-item" data-tier="obsidian">
          <div class="tier-icon"><img src="tier-obsidian.png"></div>
          <span class="tier-name">ì˜µì‹œë””ì–¸</span>
        </div>
        <div class="tier-item" data-tier="gold">
          <div class="tier-icon"><img src="tier-gold.png"></div>
          <span class="tier-name">ê³¨ë“œ</span>
        </div>
      </div>
    </div>

    <div class="eclipse-section">
      <div class="eclipse-section-title">ì´í´ë¦½ìŠ¤ ë” ì•Œì•„ë³´ê¸°</div>
      <a href="https://www.youtube.com/@Eclipse-g4e" target="_blank" class="youtube-btn">
        <svg width="24" height="24" viewBox="0 0 24 24">
          <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
          <path fill="#fff" d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
        </svg>
        ìœ íŠœë¸Œ ì±„ë„
      </a>
    </div>

    <div class="books-section">
      <div class="books-section-title">ì´í´ë¦½ìŠ¤ì˜ ì±…</div>
      <div class="books-grid">
        <a href="https://litt.ly/eclipse.thinker" target="_blank" class="book-item">
          <img src="book-philosophy.png" alt="í›”ì¹œ ì² í•™ í¸">
          <div class="book-item-title">í›”ì¹œ ì² í•™ í¸</div>
        </a>
        <a href="https://litt.ly/eclipse.thinker" target="_blank" class="book-item">
          <img src="book-psychology.png" alt="í›”ì¹œ ì‹¬ë¦¬í•™ í¸">
          <div class="book-item-title">í›”ì¹œ ì‹¬ë¦¬í•™ í¸</div>
        </a>
      </div>
    </div>

    <div class="footer">
      <div class="footer-copy">Â© ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©</div>
    </div>
  </div>

  <script type="module">
    // Firebase SDK
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, linkWithPopup } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDZ-NATGNFjQ90gswfebIV-0xqhps68qJM",
      authDomain: "eclipse-mindlab.firebaseapp.com",
      projectId: "eclipse-mindlab",
      storageBucket: "eclipse-mindlab.firebasestorage.app",
      messagingSenderId: "181450990304",
      appId: "1:181450990304:web:3043d3857815249f53e685",
      measurementId: "G-2V3Z9XZJYT"
    };

    // Firebase ì´ˆê¸°í™”
    const firebaseApp = initializeApp(firebaseConfig);
    const auth = getAuth(firebaseApp);
    const db = getFirestore(firebaseApp);

    const STORAGE_KEY = 'eclipse_mindlab_profile';
    const CURRENT_VERSION = 5;

    const TIERS = [
      { name: 'ë£¨ë¹„', key: 'ruby', minLevel: 1, color: '#ef4444', colorName: 'ë¹¨ê°„ìƒ‰' },
      { name: 'ììˆ˜ì •', key: 'amethyst', minLevel: 6, color: '#a855f7', colorName: 'ë³´ë¼ìƒ‰' },
      { name: 'ì‚¬íŒŒì´ì–´', key: 'sapphire', minLevel: 11, color: '#3b82f6', colorName: 'íŒŒë€ìƒ‰' },
      { name: 'ì—ë©”ë„ë“œ', key: 'emerald', minLevel: 16, color: '#10b981', colorName: 'ì´ˆë¡ìƒ‰' },
      { name: 'ì˜µì‹œë””ì–¸', key: 'obsidian', minLevel: 21, color: '#1f2937', colorName: 'ê²€ì€ìƒ‰' },
      { name: 'ê³¨ë“œ', key: 'gold', minLevel: 26, color: '#f59e0b', colorName: 'ê¸ˆìƒ‰' }
    ];

    const TITLES = [
      { minLevel: 1, title: 'ğŸŒ± ì´ˆë³´ íƒí—˜ê°€' },
      { minLevel: 5, title: 'ğŸŒ¿ í˜¸ê¸°ì‹¬ ë§ì€ ê´€ì°°ì' },
      { minLevel: 10, title: 'ğŸŒ³ ê¹Šì´ ìˆëŠ” ì‚¬ìƒ‰ê°€' },
      { minLevel: 20, title: 'ğŸŒŸ í†µì°°ì˜ ëŒ€ê°€' }
    ];

    const SIMULATIONS = {
      psych: [
        { id: 'idea_thief', title: 'ì•„ì´ë””ì–´ ë„ë‘‘ ë™ë£Œ', desc: 'ë„¤ ì•„ì´ë””ì–´ë¥¼ ê°€ë¡œì±ˆ ë™ë£Œ', url: 'sim-idea-thief.html' },
        { id: 'money_friend', title: 'ëˆ ì•ˆ ê°šëŠ” ì¹œêµ¬', desc: '3ê°œì›”ì§¸ 30ë§Œì›ì„ ì•ˆ ê°šëŠ” ì¹œêµ¬', url: 'sim-money-friend.html' },
        { id: 'dating_progress', title: 'ì¸ ì§„ì „ì‹œí‚¤ê¸°', desc: 'ì¹´í†¡ë§Œ í•˜ëŠ” ê´€ê³„, ì–´ë–»ê²Œ?', url: null },
        { id: 'free_rider', title: 'ë¬´ì„ìŠ¹ì°¨ íŒ€ì›', desc: 'ì¼ ì•ˆ í•˜ëŠ” íŒ€ì›', url: null },
        { id: 'parent_nagging', title: 'ë¶€ëª¨ë‹˜ ì”ì†Œë¦¬', desc: 'ì§„ë¡œì— ëŒ€í•œ ëì—†ëŠ” ì”ì†Œë¦¬', url: null }
      ],
      philosophy: [
        { id: 'trolley', title: 'íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ', desc: '5ëª…ì„ ì‚´ë¦¬ê¸° ìœ„í•´ 1ëª…ì„ ì£½ì¼ ìˆ˜ ìˆëŠ”ê°€?', url: null },
        { id: 'experience_machine', title: 'ê²½í—˜ ê¸°ê³„', desc: 'ì™„ë²½í•œ ê°€ì§œ í–‰ë³µ vs ë¶ˆì™„ì „í•œ í˜„ì‹¤', url: 'sim-experience-machine.html' }
      ]
    };

    // ë„ê° ì´ ì›ì¹™ ìˆ˜ (dex.htmlê³¼ ë™ê¸°í™” í•„ìš”)
    const DEX_TOTAL = 80;

    let profile = {
      version: CURRENT_VERSION,
      name: '',
      level: 1,
      exp: 0,
      completedSims: [],
      principles: []
    };

    function loadProfile() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        let p = JSON.parse(saved);
        if (!p.version || p.version < CURRENT_VERSION) {
          p = migrateProfile(p);
        }
        profile = p;
        return true;
      }
      return false;
    }

    function migrateProfile(old) {
      const migrated = {
        version: CURRENT_VERSION,
        name: old.name || '',
        level: old.level || 1,
        exp: old.exp || 0,
        completedSims: old.completedSims || old.completedTests || [],
        principles: old.principles || []
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(migrated));
      return migrated;
    }

    function saveProfile() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
      // Firebaseì—ë„ ì €ì¥
      saveToCloud();
    }

    // Firebase í´ë¼ìš°ë“œ ì €ì¥
    async function saveToCloud() {
      const user = auth.currentUser;
      if (!user) return;
      
      try {
        const docRef = doc(db, 'users', user.uid);
        await setDoc(docRef, {
          ...profile,
          updatedAt: new Date().toISOString()
        }, { merge: true });
        console.log('í´ë¼ìš°ë“œ ì €ì¥ ì™„ë£Œ');
      } catch (error) {
        console.error('í´ë¼ìš°ë“œ ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }

    // Firebase í´ë¼ìš°ë“œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadFromCloud() {
      const user = auth.currentUser;
      if (!user) return null;
      
      try {
        const docRef = doc(db, 'users', user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          return docSnap.data();
        }
      } catch (error) {
        console.error('í´ë¼ìš°ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
      return null;
    }

    // ë¡œì»¬ê³¼ í´ë¼ìš°ë“œ í”„ë¡œí•„ ë³‘í•©
    function mergeProfiles(local, cloud) {
      if (!cloud) return local;
      if (!local) return cloud;
      
      const merged = { ...local };
      
      // ë ˆë²¨ì´ ë†’ì€ ìª½ ì„ íƒ
      if ((cloud.level || 1) > (local.level || 1)) {
        merged.level = cloud.level;
        merged.exp = cloud.exp;
      } else if ((cloud.level || 1) === (local.level || 1)) {
        merged.exp = Math.max(cloud.exp || 0, local.exp || 0);
      }
      
      // ì´ë¦„ì€ "ìµëª… íƒí—˜ê°€"ê°€ ì•„ë‹Œ ìª½ ì„ íƒ
      if (local.name === 'ìµëª… íƒí—˜ê°€' && cloud.name && cloud.name !== 'ìµëª… íƒí—˜ê°€') {
        merged.name = cloud.name;
      }
      
      // ì™„ë£Œí•œ ì‹œë®¬ë ˆì´ì…˜ í•©ì¹˜ê¸°
      const localSims = local.completedSims || [];
      const cloudSims = cloud.completedSims || [];
      merged.completedSims = [...new Set([...localSims, ...cloudSims])];
      
      // ì›ì¹™ í•©ì¹˜ê¸°
      const localPrinciples = local.principles || [];
      const cloudPrinciples = cloud.principles || [];
      const principleMap = new Map();
      [...localPrinciples, ...cloudPrinciples].forEach(p => {
        if (p.name) principleMap.set(p.name, p);
      });
      merged.principles = Array.from(principleMap.values());
      
      // ë°ì¼ë¦¬ ë°ì´í„°
      const localDaily = local.dailyData || {};
      const cloudDaily = cloud.dailyData || {};
      merged.dailyData = {
        ...localDaily,
        ...cloudDaily,
        streak: Math.max(localDaily.streak || 0, cloudDaily.streak || 0),
        totalVotes: Math.max(localDaily.totalVotes || 0, cloudDaily.totalVotes || 0)
      };
      
      // íˆ¬í‘œ ê¸°ë¡ í•©ì¹˜ê¸°
      const localVotes = local.dailyVotes || {};
      const cloudVotes = cloud.dailyVotes || {};
      merged.dailyVotes = { ...localVotes, ...cloudVotes };
      
      return merged;
    }

    function getTier(level) {
      for (let i = TIERS.length - 1; i >= 0; i--) {
        if (level >= TIERS[i].minLevel) return TIERS[i];
      }
      return TIERS[0];
    }

    function getTitle(level) {
      for (let i = TITLES.length - 1; i >= 0; i--) {
        if (level >= TITLES[i].minLevel) return TITLES[i].title;
      }
      return TITLES[0].title;
    }

    function updateUI() {
      const tier = getTier(profile.level);
      const title = getTitle(profile.level);
      const expNeeded = profile.level * 100;
      const expPercent = (profile.exp / expNeeded) * 100;

      document.getElementById('profileName').textContent = profile.name || 'íƒí—˜ê°€';
      document.getElementById('profileTitle').textContent = title;
      document.getElementById('tierImage').src = 'tier-' + tier.key + '.png';
      document.getElementById('levelNum').textContent = profile.level;
      document.getElementById('expFill').style.width = expPercent + '%';
      document.getElementById('expText').textContent = profile.exp + '/' + expNeeded;
      
      // í‹°ì–´ ë¼ë²¨ ì—…ë°ì´íŠ¸
      const tierLabel = document.getElementById('tierLabel');
      tierLabel.textContent = tier.name;
      tierLabel.style.color = tier.color;
      tierLabel.style.background = tier.color + '20';
      
      document.getElementById('statCleared').textContent = profile.completedSims.length;
      document.getElementById('statPrinciples').textContent = profile.principles.length;

      // ì‹¬ë¦¬ ì‹œë®¬ë ˆì´ì…˜ ëª©ë¡
      const psychList = document.getElementById('psychList');
      const completedPsych = SIMULATIONS.psych.filter(s => profile.completedSims.includes(s.id)).length;
      document.getElementById('psychProgress').textContent = `${completedPsych}/${SIMULATIONS.psych.length}`;
      
      psychList.innerHTML = SIMULATIONS.psych.map(sim => {
        const isCompleted = profile.completedSims.includes(sim.id);
        const isLocked = !sim.url;
        
        let className = 'sim-item';
        if (isCompleted) className += ' completed';
        if (isLocked) className += ' locked';
        
        const status = isCompleted ? 'âœ“' : (isLocked ? 'ğŸ”’' : 'â—‹');
        const reward = isCompleted ? 'ì™„ë£Œ' : '+30 EXP';
        
        if (isLocked) {
          return `
            <div class="${className}">
              <div class="sim-status">${status}</div>
              <div class="sim-info">
                <div class="sim-title">${sim.title}</div>
                <div class="sim-desc">Coming Soon</div>
              </div>
            </div>
          `;
        }
        
        return `
          <a href="${sim.url}" class="${className}">
            <div class="sim-status">${status}</div>
            <div class="sim-info">
              <div class="sim-title">${sim.title}</div>
              <div class="sim-desc">${sim.desc}</div>
            </div>
            <div class="sim-reward">${reward}</div>
          </a>
        `;
      }).join('');

      // ì² í•™ ì‹œë®¬ë ˆì´ì…˜ ëª©ë¡
      const philList = document.getElementById('philList');
      const completedPhil = SIMULATIONS.philosophy.filter(s => profile.completedSims.includes(s.id)).length;
      document.getElementById('philProgress').textContent = `${completedPhil}/${SIMULATIONS.philosophy.length}`;
      
      philList.innerHTML = SIMULATIONS.philosophy.map(sim => {
        const isCompleted = profile.completedSims.includes(sim.id);
        const isLocked = !sim.url;
        
        let className = 'sim-item';
        if (isCompleted) className += ' completed';
        if (isLocked) className += ' locked';
        
        const status = isCompleted ? 'âœ“' : (isLocked ? 'ğŸ”’' : 'â—‹');
        const reward = isCompleted ? 'ì™„ë£Œ' : '+30 EXP';
        
        if (isLocked) {
          return `
            <div class="${className}">
              <div class="sim-status">${status}</div>
              <div class="sim-info">
                <div class="sim-title">${sim.title}</div>
                <div class="sim-desc">Coming Soon</div>
              </div>
            </div>
          `;
        }
        
        return `
          <a href="${sim.url}" class="${className}">
            <div class="sim-status">${status}</div>
            <div class="sim-info">
              <div class="sim-title">${sim.title}</div>
              <div class="sim-desc">${sim.desc}</div>
            </div>
            <div class="sim-reward">${reward}</div>
          </a>
        `;
      }).join('');

      // ì›ì¹™ ë„ê° ì§„í–‰ë„ ì—…ë°ì´íŠ¸
      const dexCount = profile.principles ? profile.principles.length : 0;
      document.getElementById('dexCount').textContent = `${dexCount}/${DEX_TOTAL}`;
      document.getElementById('dexProgressFill').style.width = `${(dexCount/DEX_TOTAL)*100}%`;

      // í‹°ì–´ ì§„í–‰ë„
      TIERS.forEach(t => {
        const item = document.querySelector(`.tier-item[data-tier="${t.key}"]`);
        if (!item) return;
        const icon = item.querySelector('.tier-icon');
        item.classList.remove('active');
        icon.classList.remove('active', 'completed');
        if (t.key === tier.key) {
          item.classList.add('active');
          icon.classList.add('active');
        } else if (profile.level >= t.minLevel) {
          icon.classList.add('completed');
        }
      });
    }

    async function init() {
      const nameInput = document.getElementById('nameInput');
      const startBtn = document.getElementById('startBtn');
      const nameModal = document.getElementById('nameModal');
      const googleSyncBtn = document.getElementById('googleSyncBtn');

      // ë¡œì»¬ í”„ë¡œí•„ ë¨¼ì € ë¡œë“œ
      loadProfile();

      // Firebase ìµëª… ë¡œê·¸ì¸ ì‹œë„
      try {
        await new Promise((resolve) => {
          onAuthStateChanged(auth, async (user) => {
            if (user) {
              console.log('Firebase ë¡œê·¸ì¸ë¨:', user.uid);
              
              // êµ¬ê¸€ ì—°ë™ ì—¬ë¶€ ì²´í¬
              if (user.providerData.some(p => p.providerId === 'google.com')) {
                googleSyncBtn.classList.add('synced');
                googleSyncBtn.title = 'êµ¬ê¸€ ì—°ë™ë¨';
              }
              
              // í´ë¼ìš°ë“œì—ì„œ í”„ë¡œí•„ ë¡œë“œ í›„ ë³‘í•©
              const cloudProfile = await loadFromCloud();
              if (cloudProfile) {
                const localProfile = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
                profile = mergeProfiles(localProfile, cloudProfile);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
                console.log('í”„ë¡œí•„ ë™ê¸°í™” ì™„ë£Œ');
              }
              resolve();
            } else {
              // ìµëª… ë¡œê·¸ì¸
              try {
                await signInAnonymously(auth);
                console.log('ìµëª… ë¡œê·¸ì¸ ì„±ê³µ');
              } catch (error) {
                console.error('ìµëª… ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
              }
              resolve();
            }
          });
        });
      } catch (error) {
        console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
      }

      // í”„ë¡œí•„ ë¡œë“œ í›„, ì´ë¦„ì´ ìˆê³  "ìµëª… íƒí—˜ê°€"ê°€ ì•„ë‹ˆë©´ ëª¨ë‹¬ ìˆ¨ê¹€
      if (profile.name && profile.name !== 'ìµëª… íƒí—˜ê°€') {
        nameModal.classList.add('hidden');
        updateUI();
      } else if (profile.name === 'ìµëª… íƒí—˜ê°€') {
        // ìµëª…ì´ë©´ ëª¨ë‹¬ì€ ë„ìš°ë˜ UIëŠ” ì—…ë°ì´íŠ¸ (EXP ë“± í‘œì‹œ)
        updateUI();
      }

      nameInput.addEventListener('input', () => {
        startBtn.disabled = nameInput.value.trim().length < 2;
        // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
        const errorMsg = document.getElementById('nameError');
        if (errorMsg) errorMsg.style.display = 'none';
      });

      startBtn.addEventListener('click', async () => {
        const name = nameInput.value.trim();
        if (name.length < 2) return;
        
        // ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
        startBtn.disabled = true;
        startBtn.textContent = 'í™•ì¸ ì¤‘...';
        
        try {
          // ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬
          const isDuplicate = await checkNicknameDuplicate(name);
          
          if (isDuplicate) {
            // ì¤‘ë³µì¸ ê²½ìš°
            let errorMsg = document.getElementById('nameError');
            if (!errorMsg) {
              errorMsg = document.createElement('div');
              errorMsg.id = 'nameError';
              errorMsg.style.cssText = 'color: #ef4444; font-size: 13px; margin-top: 8px; text-align: center;';
              nameInput.parentNode.insertBefore(errorMsg, nameInput.nextSibling);
            }
            errorMsg.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.';
            errorMsg.style.display = 'block';
            startBtn.disabled = false;
            startBtn.textContent = 'íƒí—˜ ì‹œì‘';
            return;
          }
          
          // ì¤‘ë³µ ì•„ë‹ˆë©´ ì €ì¥
          profile.name = name;
          saveProfile();
          nameModal.classList.add('hidden');
          updateUI();
        } catch (error) {
          console.error('ë‹‰ë„¤ì„ ì²´í¬ ì‹¤íŒ¨:', error);
          // ì—ëŸ¬ ì‹œ ê·¸ëƒ¥ ì§„í–‰ (ì˜¤í”„ë¼ì¸ ë“±)
          profile.name = name;
          saveProfile();
          nameModal.classList.add('hidden');
          updateUI();
        }
      });

      // ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜
      async function checkNicknameDuplicate(name) {
        const usersRef = collection(db, 'users');
        const q = query(usersRef, where('name', '==', name));
        const querySnapshot = await getDocs(q);
        
        // í˜„ì¬ ìœ ì €ì˜ uid
        const currentUid = auth.currentUser?.uid;
        
        // ë‹¤ë¥¸ ìœ ì €ê°€ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸
        let isDuplicate = false;
        querySnapshot.forEach((doc) => {
          if (doc.id !== currentUid) {
            isDuplicate = true;
          }
        });
        
        return isDuplicate;
      }

      // êµ¬ê¸€ ì—°ë™ ë²„íŠ¼
      // ì´ë¯¸ êµ¬ê¸€ ì—°ë™ëëŠ”ì§€ í™•ì¸
      const user2 = auth.currentUser;
      if (user2 && user2.providerData.some(p => p.providerId === 'google.com')) {
        googleSyncBtn.classList.add('synced');
        googleSyncBtn.title = 'êµ¬ê¸€ ì—°ë™ë¨';
      }
      
      googleSyncBtn.addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) {
          alert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        // ì´ë¯¸ êµ¬ê¸€ ì—°ë™ëìœ¼ë©´ ë¬´ì‹œ
        if (user.providerData.some(p => p.providerId === 'google.com')) {
          alert('ì´ë¯¸ êµ¬ê¸€ ê³„ì •ê³¼ ì—°ë™ë˜ì–´ ìˆìŠµë‹ˆë‹¤!');
          return;
        }
        
        try {
          const provider = new GoogleAuthProvider();
          
          // ìµëª… ê³„ì •ì„ êµ¬ê¸€ ê³„ì •ì— ì—°ê²°
          await linkWithPopup(user, provider);
          
          // ì—°ë™ ì„±ê³µ
          googleSyncBtn.classList.add('synced');
          googleSyncBtn.title = 'êµ¬ê¸€ ì—°ë™ë¨';
          alert('êµ¬ê¸€ ê³„ì • ì—°ë™ ì™„ë£Œ! ì´ì œ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          
          // í”„ë¡œí•„ ë‹¤ì‹œ ì €ì¥ (ìƒˆ uidë¡œ)
          saveProfile();
        } catch (error) {
          console.error('êµ¬ê¸€ ì—°ë™ ì‹¤íŒ¨:', error);
          console.log('ì—ëŸ¬ ì½”ë“œ:', error.code);
          
          if (error.code === 'auth/credential-already-in-use') {
            // ì´ë¯¸ ë‹¤ë¥¸ ê³„ì •ì— ì—°ê²°ëœ êµ¬ê¸€ ê³„ì •
            console.log('credential-already-in-use ê°ì§€ë¨');
            
            const loadExisting = confirm('ì´ êµ¬ê¸€ ê³„ì •ì— ê¸°ì¡´ í”„ë¡œí•„ì´ ìˆìŠµë‹ˆë‹¤.\n\nê¸°ì¡´ í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¬ê¹Œìš”?\n(í˜„ì¬ í”„ë¡œí•„ì€ ì‚­ì œë©ë‹ˆë‹¤)');
            
            console.log('ì‚¬ìš©ì ì„ íƒ:', loadExisting);
            
            if (loadExisting) {
              try {
                // êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ (ê¸°ì¡´ ìµëª… ê³„ì • ëŒ€ì²´)
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                console.log('êµ¬ê¸€ ë¡œê·¸ì¸ ì„±ê³µ:', result.user.uid);
                
                // ê¸°ì¡´ êµ¬ê¸€ ê³„ì •ì˜ í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ê¸°
                const cloudProfile = await loadFromCloud();
                console.log('í´ë¼ìš°ë“œ í”„ë¡œí•„:', cloudProfile);
                
                if (cloudProfile) {
                  profile = cloudProfile;
                  localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
                }
                
                // UI ì—…ë°ì´íŠ¸
                googleSyncBtn.classList.add('synced');
                googleSyncBtn.title = 'êµ¬ê¸€ ì—°ë™ë¨';
                nameModal.classList.add('hidden');
                updateUI();
                
                alert('ê¸°ì¡´ í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
              } catch (signInError) {
                console.error('êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨:', signInError);
                alert('í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              }
            }
          } else if (error.code === 'auth/popup-closed-by-user') {
            // ì‚¬ìš©ìê°€ íŒì—… ë‹«ìŒ
            console.log('ë¡œê·¸ì¸ ì·¨ì†Œë¨');
          } else {
            alert('ì—°ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
          }
        }
      });
    }

    init();
    
    // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
      installBtn.classList.remove('hidden');
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        installBtn.classList.add('hidden');
      }
      deferredPrompt = null;
    });

    // ì´ë¯¸ ì„¤ì¹˜ëìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
    window.addEventListener('appinstalled', () => {
      installBtn.classList.add('hidden');
      deferredPrompt = null;
    });

    // ì•± ê³µìœ  ê¸°ëŠ¥
    const shareAppBtn = document.getElementById('shareAppBtn');
    shareAppBtn.addEventListener('click', () => {
      const shareText = `ğŸ§  ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©

ë‹¹ì‹ ì˜ ë„ë• ì„±í–¥ì„ ì•Œì•„ë³´ì„¸ìš”!
ë§¤ì¼ ìƒˆë¡œìš´ ë”œë ˆë§ˆì— ë‹µí•˜ê³ , ë‚˜ì™€ ë¹„ìŠ·í•œ ì² í•™ìë¥¼ ì°¾ì•„ë³´ì„¸ìš”.

ì‹¬ë¦¬ ì‹œë®¬ë ˆì´í„° | ì˜¤ëŠ˜ì˜ ë”œë ˆë§ˆ | ì›ì¹™ ë°œê²¬`;

      if (navigator.share) {
        navigator.share({
          title: 'ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©',
          text: shareText,
          url: 'https://eclipse-mindlab.github.io/mindlab/'
        }).catch(() => {});
      } else {
        navigator.clipboard.writeText(shareText + '\n\nhttps://eclipse-mindlab.github.io/mindlab/').then(() => {
          shareAppBtn.classList.add('success');
          shareAppBtn.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            ë³µì‚¬ ì™„ë£Œ!
          `;
          setTimeout(() => {
            shareAppBtn.classList.remove('success');
            shareAppBtn.innerHTML = `
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
              ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°
            `;
          }, 2000);
        });
      }
    });

    // í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    saveProfileBtn.addEventListener('click', () => {
      const card = document.querySelector('.profile-card');
      const btn = saveProfileBtn;
      
      btn.innerHTML = 'ì €ì¥ ì¤‘...';
      
      html2canvas(card, { 
        backgroundColor: '#09090b', 
        scale: 2,
        logging: false
      }).then(canvas => {
        const link = document.createElement('a');
        const today = new Date();
        const dateStr = today.getFullYear() + '.' + String(today.getMonth()+1).padStart(2,'0') + '.' + String(today.getDate()).padStart(2,'0');
        link.download = 'mindlab-profile-' + dateStr + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        btn.classList.add('success');
        btn.innerHTML = `
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          ì €ì¥ ì™„ë£Œ!
        `;
        setTimeout(() => {
          btn.classList.remove('success');
          btn.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥
          `;
        }, 2000);
      });
    });
    
    // Service Worker ë“±ë¡
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('SW registered'))
        .catch(err => console.log('SW registration failed:', err));
    }
  </script>
</body>
</html>
