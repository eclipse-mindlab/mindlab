<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¸ ì§„ì „ì‹œí‚¤ê¸° - ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7c3aed">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #09090b;
      color: #fff;
      min-height: 100vh;
      padding: 24px;
      line-height: 1.6;
    }
    
    .container { max-width: 540px; margin: 0 auto; }
    
    .header { margin-bottom: 32px; }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #71717a;
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .back-btn:hover { color: #a78bfa; }

    .header-content { text-align: center; }
    .header-category { font-size: 12px; color: #f472b6; margin-bottom: 8px; }
    .header h1 { font-size: 22px; color: #fff; margin-bottom: 4px; }
    .header p { font-size: 14px; color: #71717a; }
    
    .progress { display: flex; gap: 8px; margin-bottom: 24px; }
    
    .progress-bar {
      height: 4px;
      flex: 1;
      border-radius: 4px;
      background: #27272a;
      transition: background 0.3s;
    }
    
    .progress-bar.completed { background: #f472b6; }
    .progress-bar.current { background: rgba(244, 114, 182, 0.5); }
    
    .scenario-card {
      background: #18181b;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .stage-label {
      font-size: 11px;
      color: #71717a;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .context {
      font-size: 13px;
      color: #a1a1aa;
      margin-bottom: 12px;
      padding: 12px;
      background: #1f1f23;
      border-radius: 8px;
    }
    
    .situation { font-size: 17px; line-height: 1.8; }
    
    .choices { display: flex; flex-direction: column; gap: 12px; }
    
    .choice-btn {
      width: 100%;
      text-align: left;
      padding: 16px;
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
      line-height: 1.6;
    }
    
    .choice-btn:hover {
      background: #27272a;
      border-color: #3f3f46;
    }
    
    .result-section { display: none; }
    .result-section.show { display: block; }
    
    .selected-choice {
      padding: 16px;
      background: #18181b;
      border: 2px solid #3f3f46;
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .selected-header { font-size: 13px; color: #71717a; margin-bottom: 8px; }
    .selected-text { color: #d4d4d8; line-height: 1.6; }
    
    .outcome-card {
      padding: 16px;
      background: rgba(24, 24, 27, 0.5);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .outcome-label { font-size: 13px; color: #71717a; margin-bottom: 8px; }
    .outcome-text { color: #d4d4d8; line-height: 1.8; }
    
    .principle-card {
      padding: 20px;
      background: linear-gradient(135deg, rgba(244, 114, 182, 0.15), #18181b);
      border: 1px solid rgba(244, 114, 182, 0.3);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .principle-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .principle-icon { font-size: 20px; }
    .principle-label {
      font-size: 11px;
      color: #f472b6;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .principle-name { color: #fff; font-weight: 600; font-size: 16px; margin-bottom: 8px; }
    .principle-explanation { color: #a1a1aa; line-height: 1.8; font-size: 14px; }

    .evaluation-card {
      display: flex;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      align-items: flex-start;
    }

    .evaluation-card.positive {
      background: rgba(74, 222, 128, 0.1);
      border: 1px solid rgba(74, 222, 128, 0.3);
    }

    .evaluation-card.neutral {
      background: rgba(251, 191, 36, 0.1);
      border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .evaluation-card.negative {
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.3);
    }

    .evaluation-icon { font-size: 18px; flex-shrink: 0; }
    .evaluation-text { font-size: 14px; line-height: 1.7; }

    .evaluation-card.positive .evaluation-text { color: #4ade80; }
    .evaluation-card.neutral .evaluation-text { color: #fbbf24; }
    .evaluation-card.negative .evaluation-text { color: #f87171; }

    .other-choices-section { margin-bottom: 16px; }

    .other-choices-toggle {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 12px;
      background: transparent;
      border: 1px solid #27272a;
      border-radius: 10px;
      color: #71717a;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .other-choices-toggle:hover {
      border-color: #3f3f46;
      color: #a1a1aa;
    }

    .other-choices-toggle.open {
      border-color: #3f3f46;
      background: #18181b;
    }

    .other-choices-toggle.open svg { transform: rotate(180deg); }

    .other-choices-content {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .other-choices-content.hidden { display: none; }

    .other-choice-card {
      background: #131316;
      border: 1px solid #1f1f23;
      border-radius: 12px;
      padding: 14px;
    }

    .other-choice-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .eval-badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
    }

    .eval-badge.positive { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
    .eval-badge.neutral { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .eval-badge.negative { background: rgba(248, 113, 113, 0.2); color: #f87171; }

    .other-choice-text { font-size: 14px; color: #a1a1aa; margin-bottom: 10px; line-height: 1.6; }

    .other-choice-outcome {
      font-size: 13px;
      color: #71717a;
      margin-bottom: 10px;
      padding: 10px;
      background: #18181b;
      border-radius: 8px;
      line-height: 1.6;
    }

    .other-choice-eval {
      font-size: 12px;
      color: #a1a1aa;
      margin-bottom: 10px;
      padding: 8px 10px;
      background: rgba(39, 39, 42, 0.5);
      border-radius: 6px;
      line-height: 1.6;
    }

    .other-choice-principle { font-size: 12px; color: #71717a; }
    .other-choice-principle strong { color: #f472b6; }

    .next-btn {
      width: 100%;
      padding: 16px;
      background: #ec4899;
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .next-btn:hover { background: #db2777; }
    
    .final-screen { display: none; padding: 20px 0; }
    .final-screen.show { display: block; }

    .clear-card {
      background: linear-gradient(135deg, #1f1f23, #18181b);
      border: 1px solid #27272a;
      border-radius: 20px;
      padding: 32px 24px;
      margin-bottom: 24px;
      text-align: center;
    }

    .clear-icon { font-size: 56px; margin-bottom: 16px; }
    .clear-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .clear-subtitle { font-size: 14px; color: #71717a; margin-bottom: 20px; }

    .clear-exp {
      display: inline-block;
      padding: 8px 16px;
      background: rgba(244, 114, 182, 0.2);
      border-radius: 20px;
      color: #f472b6;
      font-weight: 600;
    }

    .principles-collected {
      background: #18181b;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .principles-title { font-size: 14px; color: #71717a; margin-bottom: 16px; }

    .principle-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: #1f1f23;
      border-radius: 10px;
      margin-bottom: 8px;
    }

    .principle-item:last-child { margin-bottom: 0; }
    .principle-item-icon { font-size: 20px; flex-shrink: 0; }
    .principle-item-content { flex: 1; }
    .principle-item-name { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .principle-item-desc { font-size: 12px; color: #71717a; line-height: 1.5; }

    .share-section { margin-bottom: 24px; }
    .share-label { font-size: 14px; color: #71717a; margin-bottom: 12px; text-align: center; }
    .share-buttons { display: flex; gap: 10px; justify-content: center; }
    
    .share-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 12px 18px;
      background: #27272a;
      border: 1px solid #3f3f46;
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .share-btn:hover { background: #3f3f46; }
    .share-btn.success { background: #166534; border-color: #22c55e; }

    .action-buttons { display: flex; flex-direction: column; gap: 10px; }
    
    .home-btn {
      width: 100%;
      padding: 16px;
      background: #ec4899;
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: block;
      text-align: center;
    }

    .home-btn:hover { background: #db2777; }

    .restart-btn {
      width: 100%;
      padding: 16px;
      background: transparent;
      border: 1px solid #3f3f46;
      border-radius: 12px;
      color: #a1a1aa;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .restart-btn:hover { background: #27272a; color: #fff; }

    .install-btn {
      width: 100%;
      margin-top: 8px;
      padding: 14px;
      background: linear-gradient(135deg, #7c3aed, #5b21b6);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .install-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .install-btn.hidden { display: none; }

    .promo-section {
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #27272a;
    }

    .book-promo {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: linear-gradient(135deg, #1a1520 0%, #18181b 100%);
      border: 1px solid #2d2438;
      border-radius: 12px;
      text-decoration: none;
      color: #fff;
      transition: all 0.2s;
    }

    .book-promo:hover {
      border-color: #f472b6;
      transform: translateY(-2px);
    }

    .book-promo-images { display: flex; gap: 6px; flex-shrink: 0; }

    .book-promo-img {
      width: 48px;
      height: auto;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    .book-promo-text { flex: 1; }
    .book-promo-series { font-size: 11px; color: #f472b6; margin-bottom: 2px; }
    .book-promo-title { font-size: 14px; font-weight: 500; }

    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        ëŒì•„ê°€ê¸°
      </a>
      <div class="header-content">
        <div class="header-category">ì‹¬ë¦¬ Â· ì—°ì• </div>
        <h1>ì¸ ì§„ì „ì‹œí‚¤ê¸°</h1>
        <p>ì¹´í†¡ë§Œ í•˜ëŠ” ê´€ê³„, ì–´ë–»ê²Œ ì§„ì „ì‹œí‚¬ê¹Œ?</p>
      </div>
    </div>
    
    <div class="progress" id="progress"></div>
    
    <div id="game-screen">
      <div class="scenario-card">
        <div class="stage-label" id="stage-label">Stage 1</div>
        <div class="context" id="context"></div>
        <div class="situation" id="situation"></div>
      </div>
      
      <div class="choices" id="choices"></div>
      
      <div class="result-section" id="result-section">
        <div class="selected-choice">
          <div class="selected-header">ì„ íƒí•œ ë‹µë³€</div>
          <div class="selected-text" id="selected-text"></div>
        </div>
        
        <div class="outcome-card">
          <div class="outcome-label">ìƒëŒ€ë°©ì˜ ë°˜ì‘</div>
          <div class="outcome-text" id="outcome-text"></div>
        </div>
        
        <div class="principle-card">
          <div class="principle-header">
            <span class="principle-icon">ğŸ’¡</span>
            <span class="principle-label">ë°œê²¬í•œ ì›ì¹™</span>
          </div>
          <div class="principle-name" id="principle-name"></div>
          <div class="principle-explanation" id="principle-explanation"></div>
        </div>

        <div class="evaluation-card" id="evaluation-card">
          <div class="evaluation-icon" id="evaluation-icon">âš ï¸</div>
          <div class="evaluation-text" id="evaluation-text"></div>
        </div>

        <div class="other-choices-section">
          <button class="other-choices-toggle" id="other-toggle">
            <span>ë‹¤ë¥¸ ì„ íƒì€?</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          <div class="other-choices-content hidden" id="other-choices-content"></div>
        </div>
        
        <button class="next-btn" id="next-btn">ë‹¤ìŒ ìƒí™©</button>
      </div>
    </div>
    
    <div class="final-screen" id="final-screen">
      <div class="clear-card">
        <div class="clear-icon">ğŸ’•</div>
        <div class="clear-title">ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!</div>
        <div class="clear-subtitle">ì¸ ì§„ì „ì‹œí‚¤ê¸° ìƒí™©ì„ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤</div>
        <div class="clear-exp">+30 EXP íšë“!</div>
      </div>

      <div class="principles-collected">
        <div class="principles-title">ğŸ”“ ë°œê²¬í•œ ì›ì¹™ë“¤</div>
        <div id="principles-list"></div>
      </div>

      <div class="share-section">
        <div class="share-label">ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°</div>
        <div class="share-buttons">
          <button class="share-btn" id="native-share-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
              <polyline points="16 6 12 2 8 6"/>
              <line x1="12" y1="2" x2="12" y2="15"/>
            </svg>
            ê³µìœ í•˜ê¸°
          </button>
          <button class="share-btn" id="copy-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            ë§í¬ ë³µì‚¬
          </button>
        </div>
      </div>

      <div class="action-buttons">
        <a href="index.html" class="home-btn">íƒí—˜ ì§€ë„ë¡œ ëŒì•„ê°€ê¸°</a>
        <button class="restart-btn" id="restart-btn">ë‹¤ì‹œ í•´ë³´ê¸°</button>
        <button class="install-btn hidden" id="installBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  ê³„ì† íƒí—˜í•˜ê¸°
        </button>
      </div>

      <div class="promo-section">
        <a href="https://litt.ly/eclipse.thinker" target="_blank" class="book-promo">
          <div class="book-promo-images">
            <img src="book-philosophy.png" alt="í›”ì¹œ ì² í•™ í¸" class="book-promo-img">
            <img src="book-psychology.png" alt="í›”ì¹œ ì‹¬ë¦¬í•™ í¸" class="book-promo-img">
          </div>
          <div class="book-promo-text">
            <div class="book-promo-series">ì„¸ê³„ì²™í•™ì „ì§‘ ì‹œë¦¬ì¦ˆ</div>
            <div class="book-promo-title">ë” ê¹Šì€ ì›ì¹™ë“¤ì´ ê¶ê¸ˆí•˜ë‹¤ë©´</div>
          </div>
        </a>
      </div>
    </div>
  </div>

  <script>
    const SITE_URL = 'https://eclipse-mindlab.github.io/mindlab/';
    const STORAGE_KEY = 'eclipse_mindlab_profile';
    const SIM_ID = 'dating_progress';

    const stages = [
      {
        id: 1,
        context: "3ê°œì›”ì§¸ ì¹´í†¡ë§Œ í•˜ëŠ” ì‚¬ëŒì´ ìˆë‹¤. ì„œë¡œ í˜¸ê°ì€ ìˆëŠ” ê²ƒ ê°™ì€ë°, ë§Œë‚¨ìœ¼ë¡œ ì´ì–´ì§€ì§ˆ ì•ŠëŠ”ë‹¤. ì˜¤ëŠ˜ë„ ì¼ìƒ ëŒ€í™”ê°€ ì˜¤ê°€ëŠ” ì¤‘.",
        situation: "ìƒëŒ€ê°€ \"ì˜¤ëŠ˜ ì§„ì§œ í”¼ê³¤í•˜ë‹¤ ã… ã… \"ë¼ê³  ì¹´í†¡ì„ ë³´ëƒˆë‹¤. ë­ë¼ê³  ë‹µí• ê¹Œ?",
        choices: [
          {
            text: "\"í˜ë“¤ì—ˆê² ë‹¤ ã… ã…  í‘¹ ì‰¬ì–´!\"",
            outcome: "\"ì‘ ê³ ë§ˆì›Œ~\" ë‹µì¥ì´ ì˜¨ë‹¤. ëŒ€í™”ê°€ ê±°ê¸°ì„œ ëë‚œë‹¤. ì–¸ì œë‚˜ ê·¸ë¬ë“¯ì´.",
            principle: "ê³µê°í˜• ì¢…ê²°",
            principleDesc: "ê³µê°ë§Œ í•˜ë©´ ëŒ€í™”ê°€ ëë‚œë‹¤. ì•ˆì „í•˜ì§€ë§Œ, ê´€ê³„ê°€ ì§„ì „ë˜ì§€ ì•ŠëŠ”ë‹¤.",
            evaluation: "neutral",
            evalText: "ë‚˜ì˜ì§„ ì•Šì§€ë§Œ, 3ê°œì›”ì§¸ ê°™ì€ íŒ¨í„´ì´ ë°˜ë³µëœë‹¤.",
            nextStage: "stage2_passive"
          },
          {
            text: "\"ë­ê°€ ê·¸ë ‡ê²Œ í˜ë“¤ì—ˆì–´? ì–˜ê¸°í•´ë´\"",
            outcome: "ìƒëŒ€ê°€ ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ì„ í’€ì–´ë†“ê¸° ì‹œì‘í•œë‹¤. ëŒ€í™”ê°€ ê¸¸ì–´ì§„ë‹¤.",
            principle: "ì§ˆë¬¸í˜• ì—°ì¥",
            principleDesc: "ì§ˆë¬¸ì€ ëŒ€í™”ë¥¼ ì—°ì¥í•œë‹¤. ìƒëŒ€ì—ê²Œ ê´€ì‹¬ì„ í‘œí˜„í•˜ëŠ” ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ë°©ë²•.",
            evaluation: "positive",
            evalText: "ëŒ€í™”ê°€ ê¹Šì–´ì§€ê³  ìˆë‹¤. ê´€ê³„ ì§„ì „ì˜ ì²«ê±¸ìŒ.",
            nextStage: "stage2_question"
          },
          {
            text: "\"ê·¸ëŸ¼ ë§›ìˆëŠ” ê±° ë¨¹ìœ¼ëŸ¬ ê°€ì. ê¸°ë¶„ ì „í™˜ ã…‹ã…‹\"",
            outcome: "\"ã…‹ã…‹ã…‹ ê°‘ìê¸°?\" ìƒëŒ€ê°€ ë†€ë¼ë©´ì„œë„ ì›ƒëŠ” ì´ëª¨í‹°ì½˜ì„ ë³´ë‚¸ë‹¤. \"ì–¸ì œ?\"",
            principle: "í–‰ë™ ì œì•ˆ",
            principleDesc: "ë§ ëŒ€ì‹  í–‰ë™ì„ ì œì•ˆí•˜ë©´ ê´€ê³„ê°€ ì›€ì§ì¸ë‹¤. ìš©ê¸°ê°€ í•„ìš”í•˜ì§€ë§Œ íš¨ê³¼ì ì´ë‹¤.",
            evaluation: "positive",
            evalText: "ë“œë””ì–´ ë§Œë‚¨ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ìƒê²¼ë‹¤!",
            nextStage: "stage2_action"
          }
        ]
      },
      
      // Stage 2 - ì†Œê·¹ì  ê²½ë¡œ
      {
        id: "stage2_passive",
        context: "ì¼ì£¼ì¼ í›„. ë˜ ë¹„ìŠ·í•œ ëŒ€í™”ê°€ ì˜¤ê°„ë‹¤. ì´ë²ˆì—” ìƒëŒ€ê°€ \"ì£¼ë§ì— ë­í•´?\"ë¼ê³  ë¬¼ì—ˆë‹¤.",
        situation: "ì´ê±´ ê¸°íšŒì¼ ìˆ˜ë„ ìˆë‹¤. ë­ë¼ê³  ë‹µí• ê¹Œ?",
        choices: [
          {
            text: "\"ì•„ì§ ëª¨ë¥´ê² ì–´~ ë„ˆëŠ”?\"",
            outcome: "\"ë‚˜ë„ ì•„ì§~\" ì„œë¡œ ë– ë³´ê¸°ë§Œ í•˜ë‹¤ê°€ ëŒ€í™”ê°€ íì§€ë¶€ì§€ëœë‹¤. ì£¼ë§ì€ ê°ì ë³´ëƒˆë‹¤.",
            principle: "ìƒí˜¸ ë– ë³´ê¸°",
            principleDesc: "ì„œë¡œ ë¨¼ì € ë§í•˜ê¸¸ ê¸°ë‹¤ë¦¬ë©´ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.",
            evaluation: "negative",
            evalText: "ë˜ ê¸°íšŒë¥¼ ë†“ì³¤ë‹¤. ëˆ„êµ°ê°€ëŠ” ë¨¼ì € ì›€ì§ì—¬ì•¼ í•œë‹¤.",
            nextStage: "stage3_missed"
          },
          {
            text: "\"íŠ¹ë³„í•œ ê±° ì—†ëŠ”ë°, í˜¹ì‹œ ë­ í•˜ê³  ì‹¶ì€ ê±° ìˆì–´?\"",
            outcome: "\"ìŒ... ìš”ì¦˜ ë‚ ì”¨ ì¢‹ì€ë° ì–´ë”” ê°€ê³  ì‹¶ê¸´ í•´\" íŒíŠ¸ë¥¼ ì¤€ë‹¤.",
            principle: "ì—´ë¦° ì§ˆë¬¸",
            principleDesc: "ìƒëŒ€ê°€ ì›í•˜ëŠ” ê±¸ ë¬¼ìœ¼ë©´, ìƒëŒ€ê°€ ë‹µì„ ì¤„ ìˆ˜ ìˆë‹¤.",
            evaluation: "positive",
            evalText: "ìƒëŒ€ê°€ íŒíŠ¸ë¥¼ ì¤¬ë‹¤. ì´ì œ ë„¤ê°€ ì œì•ˆí•  ì°¨ë¡€ë‹¤.",
            nextStage: "stage3_hint"
          },
          {
            text: "\"ë‚˜ í† ìš”ì¼ì— XX ê°€ë ¤ê³  í•˜ëŠ”ë° ê°™ì´ ê°ˆë˜?\"",
            outcome: "ì ì‹œ ë‹µì´ ì—†ë‹¤ê°€... \"ì˜¤ ì¢‹ì•„! ëª‡ ì‹œì—?\" ì„±ê³µì´ë‹¤.",
            principle: "êµ¬ì²´ì  ì œì•ˆ",
            principleDesc: "êµ¬ì²´ì ì¸ ê³„íšì„ ì œì‹œí•˜ë©´ ìƒëŒ€ëŠ” Yes/Noë§Œ í•˜ë©´ ëœë‹¤. ê²°ì • ë¹„ìš©ì„ ë‚®ì¶°ì¤€ë‹¤.",
            evaluation: "positive",
            evalText: "ë“œë””ì–´! 3ê°œì›” ë§Œì— ì²« ë§Œë‚¨ì´ ì¡í˜”ë‹¤.",
            nextStage: "stage3_date_set"
          }
        ]
      },
      
      // Stage 2 - ì§ˆë¬¸í˜• ê²½ë¡œ
      {
        id: "stage2_question",
        context: "ìƒëŒ€ê°€ ì˜¤ëŠ˜ ìˆì—ˆë˜ í˜ë“  ì¼ì„ í„¸ì–´ë†¨ë‹¤. ì§ì¥ ìƒì‚¬ ë•Œë¬¸ì— ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì€ ì´ì•¼ê¸°. ëŒ€í™”ê°€ 30ë¶„ì§¸ ì´ì–´ì§€ê³  ìˆë‹¤.",
        situation: "ìƒëŒ€ê°€ \"ì•„ ë§í•˜ê³  ë‚˜ë‹ˆê¹Œ ì¢€ ë‚˜ì•„ì§„ë‹¤ ã…ã… ê³ ë§ˆì›Œ\"ë¼ê³  í•œë‹¤.",
        choices: [
          {
            text: "\"ì–¸ì œë“  ì–˜ê¸°í•´~ í˜ë“¤ë©´ ì—°ë½í•´\"",
            outcome: "\"ì‘ ê³ ë§ˆì›Œ ã…ã…\" ë”°ëœ»í•œ ë¶„ìœ„ê¸°ë¡œ ëŒ€í™”ê°€ ëë‚œë‹¤. ì¢‹ì€ ì‚¬ëŒìœ¼ë¡œ ê°ì¸ëë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ 'ì¢‹ì€ ì¹œêµ¬'ë‹¤.",
            principle: "ì•ˆì „ ì§€ëŒ€",
            principleDesc: "í¸ì•ˆí•œ ê´€ê³„ëŠ” ì¢‹ì§€ë§Œ, ê±°ê¸°ì„œ ë©ˆì¶”ë©´ ì—°ì¸ì´ ì•„ë‹Œ ì¹œêµ¬ë¡œ êµ³ì–´ì§„ë‹¤.",
            evaluation: "neutral",
            evalText: "ê´€ê³„ëŠ” ì¢‹ì•„ì¡Œì§€ë§Œ, ì¹œêµ¬ ì´ìƒìœ¼ë¡œ ê°ˆ ìˆ˜ ìˆì„ê¹Œ?",
            nextStage: "stage3_friendzone"
          },
          {
            text: "\"ì§ì ‘ ë§Œë‚˜ì„œ ì–˜ê¸°í–ˆìœ¼ë©´ ë” ì¢‹ì•˜ì„ í…ë° ã…ã…\"",
            outcome: "\"...ê·¸ëŸ¬ê²Œ ã…ã…\" ìƒëŒ€ê°€ ì‚´ì§ ì„¤ë Œ ë“¯í•œ ë°˜ì‘ì´ë‹¤.",
            principle: "ì•”ì‹œì  ì œì•ˆ",
            principleDesc: "ì§ì ‘ ë§Œë‚¨ì„ ì›í•œë‹¤ëŠ” ì‹ í˜¸ë¥¼ ë³´ë‚¸ë‹¤. ìƒëŒ€ê°€ ë°›ì•„ë“¤ì¼ì§€ëŠ” ë°˜ì‘ì„ ë´ì•¼ í•œë‹¤.",
            evaluation: "positive",
            evalText: "ë§Œë‚˜ê³  ì‹¶ë‹¤ëŠ” ë‰˜ì•™ìŠ¤ë¥¼ ì „ë‹¬í–ˆë‹¤. ìƒëŒ€ ë°˜ì‘ì´ ê¸ì •ì ì´ë‹¤.",
            nextStage: "stage3_signal"
          },
          {
            text: "\"ë‹¤ìŒì— ì´ëŸ° ë‚  ìˆìœ¼ë©´ ë‚´ê°€ ë§›ìˆëŠ” ê±° ì‚¬ì¤„ê²Œ. ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œìš© ã…‹ã…‹\"",
            outcome: "\"ã…‹ã…‹ã…‹ ì§„ì§œ? ì•½ì†ì´ë‹¤?\" ìƒëŒ€ê°€ ê¸°ëŒ€í•˜ëŠ” ë¶„ìœ„ê¸°.",
            principle: "ë¯¸ë˜ ì•½ì†",
            principleDesc: "ë‹¤ìŒì„ ê¸°ì•½í•˜ë©´ ê´€ê³„ì— ì—°ì†ì„±ì´ ìƒê¸´ë‹¤. ì•½ì†ì€ ê¸°ëŒ€ê°ì„ ë§Œë“ ë‹¤.",
            evaluation: "positive",
            evalText: "ì•½ì†ì´ ì¡í˜”ë‹¤! ë‹¤ìŒ ë§Œë‚¨ì˜ ëª…ë¶„ì´ ìƒê²¼ë‹¤.",
            nextStage: "stage3_promise"
          }
        ]
      },
      
      // Stage 2 - í–‰ë™ ì œì•ˆ ê²½ë¡œ
      {
        id: "stage2_action",
        context: "\"ì–¸ì œ?\"ë¼ê³  ë¬¼ì–´ë´¤ë‹¤. ë§Œë‚¨ì´ ì„±ì‚¬ë  ê²ƒ ê°™ë‹¤!",
        situation: "ì–¸ì œë¡œ í• ê¹Œ?",
        choices: [
          {
            text: "\"ì´ë²ˆ ì£¼ í† ìš”ì¼ ì–´ë•Œ? ì €ë…ì— ì‹œê°„ ë¼?\"",
            outcome: "\"í† ìš”ì¼... ê´œì°®ì•„! ì–´ë””ì„œ ë§Œë‚ ê¹Œ?\" ë°”ë¡œ ì•½ì†ì´ ì¡í˜”ë‹¤.",
            principle: "ì¦‰ì‹œ êµ¬ì²´í™”",
            principleDesc: "ê¸°íšŒê°€ ì™”ì„ ë•Œ ë°”ë¡œ êµ¬ì²´í™”í•œë‹¤. ë¯¸ë£¨ë©´ íì§€ë¶€ì§€ëœë‹¤.",
            evaluation: "positive",
            evalText: "ì™„ë²½í•˜ë‹¤! êµ¬ì²´ì ì¸ ë‚ ì§œì™€ ì‹œê°„ì´ ì •í•´ì¡Œë‹¤.",
            nextStage: "stage3_perfect"
          },
          {
            text: "\"ë‹¤ìŒ ì£¼ ì¤‘ì— ì‹œê°„ ë  ë•Œ~\"",
            outcome: "\"ã…‡ã…‡ ì•Œê² ì–´~\" ëŒ€í™”ê°€ ëë‚¬ë‹¤. ì¼ì£¼ì¼ í›„, ì„œë¡œ 'ì‹œê°„ ë  ë•Œ'ë¥¼ ê¸°ë‹¤ë¦¬ë‹¤ íì§€ë¶€ì§€ëë‹¤.",
            principle: "ëª¨í˜¸í•œ ë¯¸ë˜",
            principleDesc: "'ì–¸ì œ ì‹œê°„ ë  ë•Œ'ëŠ” ì˜ì›íˆ ì˜¤ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. êµ¬ì²´ì ì¸ ë‚ ì§œê°€ ì¤‘ìš”í•˜ë‹¤.",
            evaluation: "negative",
            evalText: "ì•„ê¹ë‹¤... ê¸°íšŒê°€ ì™”ëŠ”ë° íë¦¿í•˜ê²Œ ë„˜ê²¼ë‹¤.",
            nextStage: "stage3_vague"
          },
          {
            text: "\"ì˜¤ëŠ˜ ì–´ë•Œ? ã…‹ã…‹ ë†ë‹´ ì•„ë‹˜\"",
            outcome: "\"ã…‹ã…‹ã…‹ã…‹ ì§„ì§œ?\" ë†€ë¼ë©´ì„œë„ \"...ì ê¹, ì§„ì§œ ê°€ëŠ¥í•œë°?\"",
            principle: "ì¦‰í¥ì„±",
            principleDesc: "ì˜ˆìƒì¹˜ ëª»í•œ ì œì•ˆì€ í¥ë¶„ì„ ë§Œë“ ë‹¤. ë¦¬ìŠ¤í¬ê°€ ìˆì§€ë§Œ ê°•ë ¬í•œ ì¸ìƒì„ ë‚¨ê¸´ë‹¤.",
            evaluation: "positive",
            evalText: "ëŒ€ë‹´í•˜ë‹¤! ìƒëŒ€ê°€ ì‹ ì„ í•˜ê²Œ ë°›ì•„ë“¤ì¸ ê²ƒ ê°™ë‹¤.",
            nextStage: "stage3_spontaneous"
          }
        ]
      },

      // Stage 3ë“¤
      {
        id: "stage3_missed",
        context: "ë˜ ê¸°íšŒë¥¼ ë†“ì³¤ë‹¤. í•œ ë‹¬ í›„, ìƒëŒ€ì˜ ì¸ìŠ¤íƒ€ì— ë‹¤ë¥¸ ì‚¬ëŒê³¼ ì°ì€ ì‚¬ì§„ì´ ì˜¬ë¼ì™”ë‹¤.",
        situation: "ë§ˆìŒì´ ë³µì¡í•˜ë‹¤. ì–´ë–»ê²Œ í• ê¹Œ?",
        choices: [
          {
            text: "\"ìš”ì¦˜ ë­í•´? ì˜¤ëœë§Œì— ì—°ë½í•˜ë„¤ ã…ã…\"",
            outcome: "\"ì‘ ã…ã… ìš”ì¦˜ ì¢€ ë°”ë¹´ì–´~\" ì˜ˆì „ë§Œí¼ ì ê·¹ì ì´ì§€ ì•Šë‹¤. íƒ€ì´ë°ì„ ë†“ì¹œ ê²ƒ ê°™ë‹¤.",
            principle: "íƒ€ì´ë°ì˜ ì¤‘ìš”ì„±",
            principleDesc: "ê¸°íšŒëŠ” ë¬´í•œí•˜ì§€ ì•Šë‹¤. ë§ì„¤ì´ëŠ” ì‚¬ì´ ìƒí™©ì€ ë°”ë€ë‹¤.",
            evaluation: "negative",
            evalText: "ëŠ¦ì—ˆì„ ìˆ˜ë„ ìˆë‹¤. í•˜ì§€ë§Œ ì‹œë„ëŠ” í•´ë³¼ ê°€ì¹˜ê°€ ìˆë‹¤.",
            nextStage: "end"
          },
          {
            text: "(ê·¸ëƒ¥ ë„˜ì–´ê°„ë‹¤. ì¸ì—°ì´ ì•„ë‹ˆì—ˆë‚˜ë³´ë‹¤.)",
            outcome: "SNSë¥¼ ë³´ë©° ì”ì“¸í•´í•œë‹¤. 'ê·¸ë•Œ ë§í–ˆìœ¼ë©´ ë‹¬ë¼ì¡Œì„ê¹Œ?' ì˜ì›íˆ ì•Œ ìˆ˜ ì—†ë‹¤.",
            principle: "í›„íšŒ",
            principleDesc: "í•˜ì§€ ì•Šì€ ê²ƒì— ëŒ€í•œ í›„íšŒëŠ” ì˜¤ë˜ ê°„ë‹¤. ì‹¤íŒ¨í•´ë„ ì‹œë„í•œ ê²ƒì´ ë‚«ë‹¤.",
            evaluation: "negative",
            evalText: "ëë‚¬ë‹¤. ë‹¤ìŒì—” ìš©ê¸°ë¥¼ ë‚´ë³´ì.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_hint",
        context: "ìƒëŒ€ê°€ \"ì–´ë”” ê°€ê³  ì‹¶ê¸´ í•´\"ë¼ê³  íŒíŠ¸ë¥¼ ì¤¬ë‹¤.",
        situation: "ì´ íŒíŠ¸ë¥¼ ì–´ë–»ê²Œ í™œìš©í• ê¹Œ?",
        choices: [
          {
            text: "\"ì–´ë”” ê°€ê³  ì‹¶ì€ë°? ë‚˜ë„ ìš”ì¦˜ ì–´ë”” ê°€ê³  ì‹¶ì—ˆì–´\"",
            outcome: "\"ìŒ... ë°”ë‹¤? ì•„ë‹ˆë©´ ì‚°? ã…ã…\" ëŒ€í™”ê°€ ì´ì–´ì§„ë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ êµ¬ì²´ì ì¸ ê³„íšì€ ì—†ë‹¤.",
            principle: "ëì—†ëŠ” ëŒ€í™”",
            principleDesc: "ëŒ€í™”ë§Œ ê³„ì†ë˜ë©´ ì—ë„ˆì§€ë§Œ ì†Œëª¨ëœë‹¤. ê²°ë¡ ì„ í–¥í•´ ê°€ì•¼ í•œë‹¤.",
            evaluation: "neutral",
            evalText: "ëŒ€í™”ëŠ” ì¢‹ì§€ë§Œ, ì´ì œ í–‰ë™ìœ¼ë¡œ ì˜®ê²¨ì•¼ í•  ë•Œë‹¤.",
            nextStage: "end"
          },
          {
            text: "\"ê·¸ëŸ¼ ì´ë²ˆ ì£¼ë§ì— XX ê°€ì! ë‚´ê°€ ë§›ì§‘ ì°¾ì•„ë³¼ê²Œ\"",
            outcome: "\"ì˜¤ ì¢‹ì•„! ê¸°ëŒ€ëœë‹¤ ã…ã…\" ìƒëŒ€ê°€ ì‹ ë‚˜ëŠ” ë°˜ì‘ì´ë‹¤. ì•½ì† ì„±ì‚¬!",
            principle: "ì£¼ë„ê¶Œ",
            principleDesc: "íŒíŠ¸ë¥¼ ë°›ìœ¼ë©´ ë‚´ê°€ ë¦¬ë“œí•œë‹¤. ìƒëŒ€ëŠ” ë”°ë¼ì˜¬ ì¤€ë¹„ê°€ ë˜ì–´ ìˆë‹¤.",
            evaluation: "positive",
            evalText: "ì™„ë²½í•œ íë¦„! íŒíŠ¸ë¥¼ ìºì¹˜í•´ì„œ í–‰ë™ìœ¼ë¡œ ì—°ê²°í–ˆë‹¤.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_date_set",
        context: "ë“œë””ì–´ ì²« ë§Œë‚¨ì´ ì¡í˜”ë‹¤! í† ìš”ì¼ ì €ë…ìœ¼ë¡œ.",
        situation: "ë§Œë‚¨ ì „ì— ë­˜ ì¤€ë¹„í• ê¹Œ?",
        choices: [
          {
            text: "ì¥ì†Œë§Œ ì •í•˜ê³ , ìì—°ìŠ¤ëŸ½ê²Œ ë§Œë‚˜ì",
            outcome: "ë§Œë‚¨ ë‹¹ì¼, í¸ì•ˆí•œ ë¶„ìœ„ê¸°ë¡œ ì‹œì‘ëë‹¤. ìì—°ìŠ¤ëŸ¬ì›€ì´ ì˜¤íˆë ¤ ì¢‹ì•˜ë‹¤.",
            principle: "ìì—°ìŠ¤ëŸ¬ì›€",
            principleDesc: "ê³¼í•˜ê²Œ ì¤€ë¹„í•˜ë©´ ê¸´ì¥ëœë‹¤. ì ë‹¹í•œ ì—¬ìœ ê°€ ì¢‹ì€ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“ ë‹¤.",
            evaluation: "positive",
            evalText: "ì¢‹ì€ ì‹œì‘ì´ë‹¤! ì²« ë§Œë‚¨ì€ ì„±ê³µì .",
            nextStage: "end"
          },
          {
            text: "ë§›ì§‘, ë™ì„ , í”Œëœ Bê¹Œì§€ ì™„ë²½í•˜ê²Œ ì¤€ë¹„",
            outcome: "ì¤€ë¹„ëŠ” ì™„ë²½í–ˆì§€ë§Œ, ì•½ê°„ ê²½ì§ëœ ë¶„ìœ„ê¸°. ê·¸ë˜ë„ ìƒëŒ€ëŠ” \"ì¤€ë¹„ ë§ì´ í–ˆë„¤ ã…ã…\" ê³ ë§ˆì›Œí•œë‹¤.",
            principle: "ì •ì„±",
            principleDesc: "ì¤€ë¹„ëŠ” ì§„ì‹¬ì„ ë³´ì—¬ì¤€ë‹¤. ë‹¤ë§Œ ë„ˆë¬´ ê³¼í•˜ë©´ ë¶€ë‹´ì´ ë  ìˆ˜ ìˆë‹¤.",
            evaluation: "neutral",
            evalText: "ì •ì„±ì€ ì „í•´ì¡Œë‹¤. ë‹¤ìŒì—” ì¡°ê¸ˆ ë” ì—¬ìœ ë¡­ê²Œ.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_friendzone",
        context: "2ì£¼ í›„. ìƒëŒ€ê°€ \"ìš”ì¦˜ ê³ ë¯¼ ìˆëŠ”ë° ë“¤ì–´ì¤„ ìˆ˜ ìˆì–´?\"ë¼ê³  í•œë‹¤. ë˜ ìƒë‹´ì´ë‹¤.",
        situation: "ê³„ì† ìƒë‹´ì—­ìœ¼ë¡œ ë‚¨ì„ ê±´ê°€?",
        choices: [
          {
            text: "\"ì‘ ë§í•´ë´~ ë¬´ìŠ¨ ê³ ë¯¼ì´ì•¼?\"",
            outcome: "1ì‹œê°„ ë™ì•ˆ ìƒë‹´ì„ í•´ì¤¬ë‹¤. ê³ ë§ˆì›Œí•œë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ 'ì¢‹ì€ ì¹œêµ¬'ë‹¤.",
            principle: "ê³ ì°©í™”",
            principleDesc: "í•œ ë²ˆ êµ³ì–´ì§„ ì—­í• ì€ ë°”ê¾¸ê¸° ì–´ë µë‹¤. ì´ˆë°˜ì— í¬ì§€ì…”ë‹ì´ ì¤‘ìš”í•˜ë‹¤.",
            evaluation: "negative",
            evalText: "ì¢‹ì€ ì¹œêµ¬ë¡œ ì™„ì „íˆ ê³ ì •ëœ ê²ƒ ê°™ë‹¤...",
            nextStage: "end"
          },
          {
            text: "\"ê³ ë¯¼ ì–˜ê¸°ëŠ” ë§Œë‚˜ì„œ í•˜ì ã…ã… ë°¥ ë¨¹ìœ¼ë©´ì„œ\"",
            outcome: "\"...ê·¸ë˜ ã…ã… ê·¸ëŸ¬ì\" ë“œë””ì–´ ë§Œë‚¨ì´ ì¡í˜”ë‹¤.",
            principle: "ì—­í•  ì „í™˜",
            principleDesc: "ìƒë‹´ì—­ì—ì„œ ë²—ì–´ë‚˜ë ¤ë©´ ìƒí™©ì„ ë°”ê¿”ì•¼ í•œë‹¤. ë§Œë‚¨ì€ ê´€ê³„ë¥¼ ë‹¤ë¥´ê²Œ ë§Œë“ ë‹¤.",
            evaluation: "positive",
            evalText: "ì˜í–ˆë‹¤! ì˜¨ë¼ì¸ ìƒë‹´ì—­ì—ì„œ ë²—ì–´ë‚  ê¸°íšŒë‹¤.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_signal",
        context: "\"ì§ì ‘ ë§Œë‚˜ì„œ ì–˜ê¸°í–ˆìœ¼ë©´ ë” ì¢‹ì•˜ì„ í…ë°\"ì— ìƒëŒ€ê°€ \"ê·¸ëŸ¬ê²Œ ã…ã…\"ë¼ê³  í–ˆë‹¤.",
        situation: "ì—¬ê¸°ì„œ ì–´ë–»ê²Œ ì´ì–´ê°ˆê¹Œ?",
        choices: [
          {
            text: "\"ë‹¤ìŒì—” ì§„ì§œ ë§Œë‚˜ì ã…ã…\"",
            outcome: "\"ã…‡ã…‡ ê·¸ëŸ¬ì~\" ì•½ì† ê°™ì€ ì•½ì†ì´ ëë‹¤. ì–¸ì  ê°„... ì•„ë§ˆë„...",
            principle: "ëª¨í˜¸í•œ í•©ì˜",
            principleDesc: "êµ¬ì²´ì ì´ì§€ ì•Šì€ ì•½ì†ì€ ì•½ì†ì´ ì•„ë‹ˆë‹¤.",
            evaluation: "neutral",
            evalText: "ë°©í–¥ì€ ë§ì§€ë§Œ, ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ ë°€ì–´ë¶™ì—¬ì•¼ í•œë‹¤.",
            nextStage: "end"
          },
          {
            text: "\"ê·¸ëŸ¼ ì´ë²ˆ ì£¼ì— ë§Œë‚ ê¹Œ? ì§„ì§€í•˜ê²Œ ã…ã…\"",
            outcome: "\"ã…‹ã…‹ã…‹ ê°‘ìê¸° ì§„ì§€í•´ì¡Œë„¤. ì¢‹ì•„, ì–¸ì œ?\" ì„±ê³µ!",
            principle: "ì „í™˜ì  í™œìš©",
            principleDesc: "ë¶„ìœ„ê¸°ê°€ ë¬´ë¥´ìµì—ˆì„ ë•Œ í•œ ë°œ ë” ë‚˜ê°„ë‹¤. íƒ€ì´ë°ì„ ë†“ì¹˜ì§€ ì•ŠëŠ”ë‹¤.",
            evaluation: "positive",
            evalText: "ì™„ë²½í•œ íƒ€ì´ë°! ë§Œë‚¨ì´ ì„±ì‚¬ëë‹¤.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_promise",
        context: "\"ë§›ìˆëŠ” ê±° ì‚¬ì¤„ê²Œ\" ì•½ì†ì— ìƒëŒ€ê°€ \"ì§„ì§œ? ì•½ì†ì´ë‹¤?\"ë¼ê³  í–ˆë‹¤.",
        situation: "ì•½ì†ì„ êµ¬ì²´í™”í•  ì°¨ë¡€ë‹¤.",
        choices: [
          {
            text: "\"ì‘ ã…‹ã…‹ ë‹¤ìŒì— í˜ë“¤ ë•Œ ì—°ë½í•´~\"",
            outcome: "\"ã…‡ã…‡ ê³ ë§ˆì›Œ~\" ì•½ì†ì€ í–ˆì§€ë§Œ... 'ë‹¤ìŒì—'ëŠ” ì–¸ì œì¼ê¹Œ?",
            principle: "ë¶ˆí™•ì‹¤í•œ ì•½ì†",
            principleDesc: "ì¡°ê±´ë¶€ ì•½ì†ì€ ì‹¤í˜„ë˜ê¸° ì–´ë µë‹¤. ë‚ ì§œë¥¼ ì •í•´ì•¼ ì•½ì†ì´ë‹¤.",
            evaluation: "neutral",
            evalText: "ì•„ì‰½ë‹¤. ì•½ì†ì„ êµ¬ì²´í™”í–ˆì–´ì•¼ í–ˆë‹¤.",
            nextStage: "end"
          },
          {
            text: "\"ê·¸ëŸ¼ ë‹¤ìŒ ì£¼ ê¸ˆìš”ì¼ ì–´ë•Œ? í‡´ê·¼í•˜ê³  ë§›ìˆëŠ” ê±° ë¨¹ì\"",
            outcome: "\"ì¢‹ì•„! ê¸ˆìš”ì¼ ì €ë…ì´ë‹¤~\" ë‚ ì§œê°€ ì¡í˜”ë‹¤!",
            principle: "ì•½ì† êµ¬ì²´í™”",
            principleDesc: "ì•½ì†ì— ë‚ ì§œì™€ ì‹œê°„ì„ ë¶™ì´ë©´ í˜„ì‹¤ì´ ëœë‹¤.",
            evaluation: "positive",
            evalText: "ì™„ë²½! ê¸ˆìš”ì¼ ì €ë…, ì²« ë§Œë‚¨ì´ í™•ì •ëë‹¤.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_perfect",
        context: "í† ìš”ì¼ ì €ë…ìœ¼ë¡œ ì•½ì†ì´ ì¡í˜”ë‹¤. ì¥ì†Œë„ ì •í–ˆë‹¤.",
        situation: "ë§Œë‚¨ ì „, ë­”ê°€ ë” í•  ê²Œ ìˆì„ê¹Œ?",
        choices: [
          {
            text: "ì•½ì† ì „ë‚  \"ë‚´ì¼ ê¸°ëŒ€ëœë‹¤ ã…ã…\" ë©”ì‹œì§€ ë³´ë‚´ê¸°",
            outcome: "\"ë‚˜ë„! ã…ã…\" ìƒëŒ€ë„ ê¸°ëŒ€í•˜ê³  ìˆë‹¤. ì„¤ë ˆëŠ” ë¶„ìœ„ê¸°ê°€ ì´ì–´ì§„ë‹¤.",
            principle: "ê¸°ëŒ€ê° ìœ ì§€",
            principleDesc: "ë§Œë‚¨ ì „ ê°€ë²¼ìš´ ë©”ì‹œì§€ëŠ” ê¸°ëŒ€ê°ì„ ìœ ì§€ì‹œí‚¨ë‹¤.",
            evaluation: "positive",
            evalText: "ì¢‹ì€ ë¶„ìœ„ê¸° ìœ ì§€! ë§Œë‚¨ì´ ë” ê¸°ëŒ€ëœë‹¤.",
            nextStage: "end"
          },
          {
            text: "ë‹¹ì¼ê¹Œì§€ ì—°ë½ ì•ˆ í•˜ê³  ë§Œë‚¨ì— ì§‘ì¤‘",
            outcome: "ë‹¹ì¼ ë§Œë‚¬ë‹¤. ì–´ìƒ‰í•˜ì§„ ì•Šì•˜ì§€ë§Œ, ì¡°ê¸ˆ ê¹€ë¹ ì§„ ëŠë‚Œ? ê´œì°®ê¸´ í–ˆë‹¤.",
            principle: "ê±°ë¦¬ë‘ê¸°",
            principleDesc: "ì ë‹¹í•œ ê±°ë¦¬ë‘ê¸°ëŠ” ì¢‹ì§€ë§Œ, ë„ˆë¬´ ë©€ë©´ ê´€ì‹¬ì´ ì‹ì„ ìˆ˜ ìˆë‹¤.",
            evaluation: "neutral",
            evalText: "ë‚˜ì˜ì§„ ì•Šì§€ë§Œ, ì¡°ê¸ˆ ì•„ì‰½ë‹¤.",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_vague",
        context: "\"ë‹¤ìŒ ì£¼ ì¤‘ì— ì‹œê°„ ë  ë•Œ\" ì´í›„ ì¼ì£¼ì¼ì´ ì§€ë‚¬ë‹¤. ì„œë¡œ ì—°ë½ì´ ëœ¸í•´ì¡Œë‹¤.",
        situation: "ì´ëŒ€ë¡œ íì§€ë¶€ì§€ë  ê²ƒ ê°™ë‹¤. ì–´ë–»ê²Œ í• ê¹Œ?",
        choices: [
          {
            text: "\"ì €ë²ˆì— ì–˜ê¸°í•œ ê±° ì•„ì§ ìœ íš¨í•´? ã…ã… ì´ë²ˆ ì£¼ í† ìš”ì¼ ì–´ë•Œ?\"",
            outcome: "\"ì•„ ë§ë‹¤ ã…‹ã…‹ í† ìš”ì¼ ê´œì°®ì•„!\" ì•„ì§ ëŠ¦ì§€ ì•Šì•˜ë‹¤.",
            principle: "ì¬ì í™”",
            principleDesc: "íì§€ë¶€ì§€ëœ ì•½ì†ë„ ë˜ì‚´ë¦´ ìˆ˜ ìˆë‹¤. ìš©ê¸°ê°€ í•„ìš”í•  ë¿.",
            evaluation: "positive",
            evalText: "ì˜ ì‚´ë ¸ë‹¤! í¬ê¸°í•˜ì§€ ì•Šì€ ê²Œ ì£¼íš¨í–ˆë‹¤.",
            nextStage: "end"
          },
          {
            text: "(ê·¸ëƒ¥ ë‘”ë‹¤. ìƒëŒ€ë„ ì—°ë½ ì•ˆ í•˜ëŠ” ê±° ë³´ë©´ ë³„ë¡œì¸ê°€ë³´ë‹¤.)",
            outcome: "ê·¸ë ‡ê²Œ ì—°ë½ì´ ëŠê²¼ë‹¤. ê°€ë” 'ê·¸ë•Œ ë§í• ê±¸' í›„íšŒí•œë‹¤.",
            principle: "ì†Œê·¹ì  í¬ê¸°",
            principleDesc: "ìƒëŒ€ íƒ“ìœ¼ë¡œ ëŒë¦¬ë©° í¬ê¸°í•˜ë©´ í¸í•˜ì§€ë§Œ, í›„íšŒê°€ ë‚¨ëŠ”ë‹¤.",
            evaluation: "negative",
            evalText: "ì•„ì‰½ê²Œ ëë‚¬ë‹¤. í•œ ë²ˆë§Œ ë” ì‹œë„í–ˆìœ¼ë©´...",
            nextStage: "end"
          }
        ]
      },
      
      {
        id: "stage3_spontaneous",
        context: "\"ì˜¤ëŠ˜ ì–´ë•Œ?\"ì— ìƒëŒ€ê°€ \"ì§„ì§œ ê°€ëŠ¥í•œë°?\"ë¼ê³  í–ˆë‹¤.",
        situation: "ì§„ì§œ ì˜¤ëŠ˜ ë§Œë‚˜ê²Œ ìƒê²¼ë‹¤!",
        choices: [
          {
            text: "\"ã…‹ã…‹ã…‹ ì§„ì§œë¡œ! 7ì‹œì— XXì—­ ì–´ë•Œ?\"",
            outcome: "\"ì˜¤ì¼€ì´! ã…‹ã…‹ã…‹ ì§„ì§œ ê°€ëŠ” ê±°ë‹¤?\" ë‘ ì‹œê°„ í›„, ì‹¤ì œë¡œ ë§Œë‚¬ë‹¤. ìµœê³ ì˜ ì²« ë§Œë‚¨ì´ì—ˆë‹¤.",
            principle: "ê²°ë‹¨ë ¥",
            principleDesc: "ë§í•œ ëŒ€ë¡œ í–‰ë™í•œë‹¤. ì¦‰í¥ì„±ê³¼ ê²°ë‹¨ë ¥ì´ ê°•ë ¬í•œ ì¸ìƒì„ ë‚¨ê¸´ë‹¤.",
            evaluation: "positive",
            evalText: "ì™„ë²½! ë§ â†’ í–‰ë™ â†’ ê²°ê³¼. ì´ìƒì ì¸ íë¦„ì´ë‹¤.",
            nextStage: "end"
          },
          {
            text: "\"ã…‹ã…‹ã…‹ ë†ë‹´ì¸ë°~ ë‹¤ìŒì— ì§„ì§œ ê°€ì\"",
            outcome: "\"ë­ì•¼ ã…‹ã…‹ã…‹\" ìƒëŒ€ê°€ ì‚´ì§ ì‹¤ë§í•œ ê²ƒ ê°™ë‹¤. ë¶„ìœ„ê¸°ê°€ ê¹€ë¹ ì¡Œë‹¤.",
            principle: "ë²ˆë³µ",
            principleDesc: "ë§ì„ ë²ˆë³µí•˜ë©´ ì‹ ë¢°ê°€ ê¹ì¸ë‹¤. ë˜ì§„ ë§ì—” ì±…ì„ì„ ì ¸ì•¼ í•œë‹¤.",
            evaluation: "negative",
            evalText: "ì•„ì‰½ë‹¤... ì¢‹ì€ ê¸°íšŒì˜€ëŠ”ë°.",
            nextStage: "end"
          }
        ]
      }
    ];

    let currentStageId = 1;
    let collectedPrinciples = [];
    let stageHistory = [];

    function getStageById(id) {
      return stages.find(s => s.id === id);
    }

    function init() {
      renderProgress();
      renderStage();
      
      document.getElementById('next-btn').addEventListener('click', nextStage);
      document.getElementById('restart-btn').addEventListener('click', restart);
      document.getElementById('native-share-btn').addEventListener('click', nativeShare);
      document.getElementById('copy-btn').addEventListener('click', copyLink);
      document.getElementById('other-toggle').addEventListener('click', toggleOtherChoices);
    }

    function toggleOtherChoices() {
      const content = document.getElementById('other-choices-content');
      const toggle = document.getElementById('other-toggle');
      content.classList.toggle('hidden');
      toggle.classList.toggle('open');
    }

    function renderProgress() {
      const totalStages = 3;
      const currentCount = stageHistory.length;
      
      const progressEl = document.getElementById('progress');
      progressEl.innerHTML = Array(totalStages).fill(0).map((_, idx) => {
        let className = 'progress-bar';
        if (idx < currentCount) className += ' completed';
        else if (idx === currentCount) className += ' current';
        return `<div class="${className}"></div>`;
      }).join('');
    }

    function renderStage() {
      const stage = getStageById(currentStageId);
      if (!stage) return;
      
      document.getElementById('stage-label').textContent = `Stage ${stageHistory.length + 1}`;
      document.getElementById('context').textContent = stage.context;
      document.getElementById('situation').textContent = stage.situation;
      
      const choicesEl = document.getElementById('choices');
      choicesEl.innerHTML = stage.choices.map((choice, idx) => `
        <button class="choice-btn" data-index="${idx}">${choice.text}</button>
      `).join('');
      
      choicesEl.querySelectorAll('.choice-btn').forEach(btn => {
        btn.addEventListener('click', () => handleChoice(parseInt(btn.dataset.index)));
      });
      
      document.getElementById('choices').classList.remove('hidden');
      document.getElementById('result-section').classList.remove('show');
    }

    function handleChoice(index) {
      const stage = getStageById(currentStageId);
      const choice = stage.choices[index];
      
      stageHistory.push({
        stageId: currentStageId,
        choiceIndex: index,
        principle: choice.principle
      });
      
      if (!collectedPrinciples.find(p => p.name === choice.principle)) {
        collectedPrinciples.push({
          name: choice.principle,
          desc: choice.principleDesc
        });
      }
      
      document.getElementById('choices').classList.add('hidden');
      document.getElementById('result-section').classList.add('show');
      
      document.getElementById('selected-text').textContent = choice.text;
      document.getElementById('outcome-text').textContent = choice.outcome;
      document.getElementById('principle-name').textContent = choice.principle;
      document.getElementById('principle-explanation').textContent = choice.principleDesc;
      
      const evalCard = document.getElementById('evaluation-card');
      const evalIcon = document.getElementById('evaluation-icon');
      const evalText = document.getElementById('evaluation-text');
      
      evalCard.className = 'evaluation-card ' + choice.evaluation;
      evalText.textContent = choice.evalText;
      
      if (choice.evaluation === 'positive') evalIcon.textContent = 'âœ“';
      else if (choice.evaluation === 'neutral') evalIcon.textContent = 'âš ï¸';
      else evalIcon.textContent = 'âœ—';
      
      const otherChoices = stage.choices.filter((_, i) => i !== index);
      const otherContent = document.getElementById('other-choices-content');
      otherContent.innerHTML = otherChoices.map(c => {
        let evalBadge = '';
        if (c.evaluation === 'positive') evalBadge = '<span class="eval-badge positive">âœ“ íš¨ê³¼ì </span>';
        else if (c.evaluation === 'neutral') evalBadge = '<span class="eval-badge neutral">âš ï¸ ìƒí™©ì— ë”°ë¼</span>';
        else evalBadge = '<span class="eval-badge negative">âœ— ë¦¬ìŠ¤í¬</span>';
        
        return `
          <div class="other-choice-card">
            <div class="other-choice-header">${evalBadge}</div>
            <div class="other-choice-text">${c.text}</div>
            <div class="other-choice-outcome">${c.outcome}</div>
            <div class="other-choice-eval">${c.evalText}</div>
            <div class="other-choice-principle"><strong>${c.principle}</strong>: ${c.principleDesc}</div>
          </div>
        `;
      }).join('');
      
      document.getElementById('other-choices-content').classList.add('hidden');
      document.getElementById('other-toggle').classList.remove('open');
      
      const nextBtn = document.getElementById('next-btn');
      if (choice.nextStage === 'end') {
        nextBtn.textContent = 'ê²°ê³¼ ë³´ê¸°';
      } else {
        nextBtn.textContent = 'ë‹¤ìŒ ìƒí™©';
      }
      
      currentStageId = choice.nextStage;
      renderProgress();
    }

    function nextStage() {
      if (currentStageId === 'end') {
        showFinalScreen();
      } else {
        renderStage();
      }
    }

    function showFinalScreen() {
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('final-screen').classList.add('show');
      
      const principlesList = document.getElementById('principles-list');
      principlesList.innerHTML = collectedPrinciples.map(p => `
        <div class="principle-item">
          <div class="principle-item-icon">ğŸ’¡</div>
          <div class="principle-item-content">
            <div class="principle-item-name">${p.name}</div>
            <div class="principle-item-desc">${p.desc}</div>
          </div>
        </div>
      `).join('');
      
      saveProgress();
      showInstallButton();
    }

    function saveProgress() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        const profile = JSON.parse(saved);
        
        if (!profile.completedSims) profile.completedSims = [];
        if (!profile.principles) profile.principles = [];
        
        const isFirstTime = !profile.completedSims.includes(SIM_ID);
        
        if (isFirstTime) {
          profile.completedSims.push(SIM_ID);
          profile.exp = (profile.exp || 0) + 30;
          
          const expNeeded = (profile.level || 1) * 100;
          while (profile.exp >= expNeeded) {
            profile.exp -= expNeeded;
            profile.level = (profile.level || 1) + 1;
          }
        }
        
        collectedPrinciples.forEach(p => {
          if (!profile.principles.find(existing => existing.name === p.name)) {
            profile.principles.push(p);
          }
        });
        
        localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
      }
    }

    function getShareText() {
      return `ğŸ’• ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©

[ì¸ ì§„ì „ì‹œí‚¤ê¸°] í´ë¦¬ì–´!

ë°œê²¬í•œ ì›ì¹™ ${collectedPrinciples.length}ê°œ:
${collectedPrinciples.map(p => 'â€¢ ' + p.name).join('\n')}

ë‹¹ì‹ ì˜ ì¸ì€ ì–´ë–»ê²Œ ë ê¹Œìš”?`;
    }

    function nativeShare() {
      if (navigator.share) {
        navigator.share({
          title: 'ì¸ ì§„ì „ì‹œí‚¤ê¸° - ì´í´ë¦½ìŠ¤ ë§ˆì¸ë“œë©',
          text: getShareText(),
          url: SITE_URL
        }).catch(() => {});
      } else {
        copyLink();
      }
    }

    function copyLink() {
      const text = getShareText() + '\n' + SITE_URL;
      const btn = document.getElementById('copy-btn');
      
      navigator.clipboard.writeText(text).then(() => {
        btn.classList.add('success');
        btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> ë³µì‚¬ ì™„ë£Œ!`;
        setTimeout(() => {
          btn.classList.remove('success');
          btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> ë§í¬ ë³µì‚¬`;
        }, 2000);
      });
    }

    function restart() {
      currentStageId = 1;
      collectedPrinciples = [];
      stageHistory = [];
      
      document.getElementById('final-screen').classList.remove('show');
      document.getElementById('game-screen').classList.remove('hidden');
      
      renderProgress();
      renderStage();
    }

    // PWA
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });

    function showInstallButton() {
      if (deferredPrompt && installBtn) {
        installBtn.classList.remove('hidden');
      }
    }

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        installBtn.classList.add('hidden');
      }
      deferredPrompt = null;
    });

    window.addEventListener('appinstalled', () => {
      installBtn.classList.add('hidden');
      deferredPrompt = null;
    });

    init();
  </script>
</body>
</html>
