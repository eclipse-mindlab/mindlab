<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오늘의 딜레마 - 이클립스의 딜렘</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6d5dbc">
  <meta property="og:title" content="오늘의 딜레마 - 이클립스의 딜렘">
  <meta property="og:description" content="당신의 선택은? 매일 새로운 철학적 딜레마에 답하세요.">
  <meta property="og:image" content="https://eclipse-mindlab.github.io/mindlab/og-image.png?v=2">
  <meta property="og:url" content="https://eclipse-mindlab.github.io/mindlab/daily.html">
  <meta name="twitter:card" content="summary_large_image">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #09090b;
      color: #fff;
      min-height: 100vh;
      padding: 24px;
      line-height: 1.6;
    }
    
    .container { max-width: 540px; margin: 0 auto; }
    .header { margin-bottom: 24px; }
    
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #8b8b92;
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .back-btn:hover { color: #9580ff; }
    
    .header-content { text-align: center; }
    
    .date-badge {
      display: inline-block;
      padding: 6px 12px;
      background: rgba(167, 139, 250, 0.2);
      border-radius: 20px;
      font-size: 13px;
      color: #9580ff;
      margin-bottom: 12px;
    }
    
    .header h1 { font-size: 24px; margin-bottom: 4px; }
    .header p { font-size: 14px; color: #8b8b92; }
    
    .streak-card {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(251, 191, 36, 0.05));
      border: 1px solid rgba(251, 191, 36, 0.3);
      border-radius: 12px;
      margin-bottom: 24px;
    }
    
    .streak-icon { font-size: 20px; }
    .streak-text { font-size: 14px; color: #fbbf24; }
    .streak-num { font-weight: 700; }
    
    .dilemma-card {
      background: #141417;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
    }
    
    .dilemma-category {
      font-size: 11px;
      color: #9580ff;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }
    
    .dilemma-situation { font-size: 17px; line-height: 1.8; margin-bottom: 16px; }
    
    .dilemma-question {
      font-size: 15px;
      color: #d4d4d8;
      padding: 12px;
      background: #1a1a1e;
      border-radius: 8px;
    }
    
    .choices { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
    
    .choice-btn {
      width: 100%;
      text-align: left;
      padding: 16px;
      background: #141417;
      border: 2px solid #232326;
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
      line-height: 1.5;
    }
    
    .choice-btn:hover { border-color: #9580ff; background: #1a1a1e; }
    .choice-btn.selected { border-color: #9580ff; background: rgba(167, 139, 250, 0.1); }
    .choice-btn.revealed { cursor: default; }
    .choice-btn.revealed:hover { border-color: #232326; background: #141417; }
    .choice-btn.selected.revealed { border-color: #9580ff; background: rgba(167, 139, 250, 0.1); }
    
    .choice-content { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .choice-text { flex: 1; }
    
    .choice-stats { display: none; flex-direction: column; align-items: flex-end; gap: 4px; }
    .choice-stats.show { display: flex; }
    .stat-percent { font-size: 18px; font-weight: 700; color: #9580ff; }
    .stat-bar { width: 60px; height: 4px; background: #232326; border-radius: 2px; overflow: hidden; }
    .stat-fill { height: 100%; background: #9580ff; border-radius: 2px; transition: width 0.5s ease; }
    
    .result-section { display: none; margin-top: 24px; }
    .result-section.show { display: block; }
    
    /* 성향 카드 */
    .profile-card-wrapper { margin-bottom: 20px; }
    
    .profile-card {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f1a 100%);
      border-radius: 20px;
      padding: 28px 24px;
      position: relative;
      overflow: hidden;
    }
    
    .profile-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(167, 139, 250, 0.15) 0%, transparent 70%);
    }
    
    .profile-card-content { position: relative; z-index: 1; }
    
    .profile-top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }
    
    .profile-badge {
      padding: 6px 12px;
      background: rgba(167, 139, 250, 0.2);
      border: 1px solid rgba(167, 139, 250, 0.3);
      border-radius: 20px;
      font-size: 11px;
      color: #9580ff;
    }
    
    .profile-percent { text-align: right; }
    .percent-label { font-size: 11px; color: #8b8b92; margin-bottom: 2px; }
    .percent-value { font-size: 32px; font-weight: 700; color: #fff; }
    .percent-suffix { font-size: 16px; color: #9580ff; }
    
    .profile-type { margin-bottom: 16px; }
    .type-label { font-size: 12px; color: #8b8b92; margin-bottom: 4px; }
    .type-name { font-size: 24px; font-weight: 700; color: #fff; margin-bottom: 4px; }
    .type-desc { font-size: 14px; color: #a1a1aa; line-height: 1.6; }
    
    .profile-philosopher {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .philosopher-emoji { font-size: 36px; }
    .philosopher-info { flex: 1; }
    .philosopher-label { font-size: 11px; color: #8b8b92; margin-bottom: 2px; }
    .philosopher-name { font-size: 16px; font-weight: 600; color: #fff; }
    .philosopher-desc { font-size: 12px; color: #a1a1aa; }
    
    .profile-branding {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .branding-logo { display: flex; align-items: center; gap: 8px; }
    .branding-icon { font-size: 20px; }
    .branding-text { font-size: 12px; color: #8b8b92; }
    .branding-date { font-size: 11px; color: #52525b; }
    
    .card-actions { display: flex; gap: 10px; margin-bottom: 20px; }
    
    .action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px;
      background: #6d5dbc;
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .action-btn:hover { background: #6d28d9; }
    .action-btn.secondary { background: #232326; border: 1px solid #35353a; }
    .action-btn.secondary:hover { background: #35353a; }
    .action-btn.success { background: #166534; }
    
    .research-card {
      background: #141417;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .research-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .research-icon { font-size: 18px; }
    .research-label { font-size: 12px; color: #8b8b92; text-transform: uppercase; letter-spacing: 1px; }
    .research-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
    .research-desc { font-size: 14px; color: #a1a1aa; line-height: 1.8; margin-bottom: 12px; }
    
    .research-source {
      font-size: 12px;
      color: #8b8b92;
      padding: 10px 12px;
      background: #1a1a1e;
      border-radius: 8px;
      border-left: 2px solid #9580ff;
    }
    
    .home-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #6d5dbc, #9580ff);
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
      transition: all 0.2s;
    }
    
    .home-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
    }
    
    .already-done { text-align: center; padding: 40px 20px; }
    .already-icon { font-size: 48px; margin-bottom: 16px; }
    .already-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
    .already-desc { font-size: 14px; color: #8b8b92; margin-bottom: 8px; }
    .already-choice { font-size: 14px; color: #9580ff; margin-bottom: 24px; }
    
    .tomorrow-timer {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: #141417;
      border-radius: 12px;
      font-size: 14px;
      color: #8b8b92;
    }
    
    .timer-num { color: #fff; font-weight: 600; font-family: monospace; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        돌아가기
      </a>
      <div class="header-content">
        <div class="date-badge" id="dateDisplay"></div>
        <h1>오늘의 딜레마</h1>
        <p>당신의 선택은?</p>
      </div>
    </div>
    
    <div class="streak-card" id="streakCard" style="display: none;">
      <span class="streak-icon">🔥</span>
      <span class="streak-text"><span class="streak-num" id="streakNum">0</span>일 연속 참여 중!</span>
    </div>
    
    <div id="mainContent">
      <div class="dilemma-card">
        <div class="dilemma-category" id="dilemmaCategory">심리</div>
        <div class="dilemma-situation" id="dilemmaSituation"></div>
        <div class="dilemma-question" id="dilemmaQuestion"></div>
      </div>
      
      <div class="choices" id="choices"></div>
      
      <div class="result-section" id="resultSection">
        <div class="profile-card-wrapper">
          <div class="profile-card" id="profileCard">
            <div class="profile-card-content">
              <div class="profile-top-row">
                <div class="profile-badge" id="cardBadge">오늘의 딜레마</div>
                <div class="profile-percent">
                  <div class="percent-label">당신은</div>
                  <div><span class="percent-value" id="cardPercent">15</span><span class="percent-suffix">%</span></div>
                </div>
              </div>
              
              <div class="profile-type">
                <div class="type-label">당신의 성향</div>
                <div class="type-name" id="cardTypeName">원칙주의자</div>
                <div class="type-desc" id="cardTypeDesc">다수가 선택하지 않는 길을 갈 줄 아는 소수파입니다.</div>
              </div>
              
              <div class="profile-philosopher">
                <div class="philosopher-emoji" id="cardPhiloEmoji">🎭</div>
                <div class="philosopher-info">
                  <div class="philosopher-label">비슷한 성향의 철학자</div>
                  <div class="philosopher-name" id="cardPhiloName">임마누엘 칸트</div>
                  <div class="philosopher-desc" id="cardPhiloDesc">"의무를 위한 의무"</div>
                </div>
              </div>
              
              <div class="profile-branding">
                <div class="branding-logo">
                  <span class="branding-icon">🧠</span>
                  <span class="branding-text">이클립스의 딜렘</span>
                </div>
                <div class="branding-date" id="cardDate"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="action-btn" id="saveImageBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            이미지 저장
          </button>
          <button class="action-btn secondary" id="shareBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
            </svg>
            공유하기
          </button>
        </div>

        <!-- 다른 선택지 해설 (아코디언) -->
        <div class="other-choice-section" style="margin: 20px 0;">
          <button class="other-choice-toggle" id="otherChoiceToggleFirst" style="width: 100%; background: #141417; border: 1px solid #232326; border-radius: 12px; padding: 16px; color: #8b8b92; font-size: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
            <span>🔍 다른 선택을 했다면?</span>
            <span id="toggleArrowFirst">▼</span>
          </button>
          <div class="other-choice-content hidden" id="otherChoiceContentFirst" style="background: #141417; border: 1px solid #232326; border-top: none; border-radius: 0 0 12px 12px; padding: 16px; margin-top: -1px;">
            <div style="font-size: 14px; color: #d4d4d8; margin-bottom: 12px;" id="otherChoiceTextFirst"></div>
            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
              <span style="background: #232326; padding: 4px 10px; border-radius: 20px; font-size: 13px; color: #9580ff;" id="otherPercentFirst"></span>
              <span style="background: #232326; padding: 4px 10px; border-radius: 20px; font-size: 13px; color: #fbbf24;" id="otherTypeFirst"></span>
            </div>
            <div style="font-size: 13px; color: #a1a1aa; margin-bottom: 8px;" id="otherTypeDescFirst"></div>
            <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #09090b; border-radius: 8px;">
              <span style="font-size: 24px;" id="otherPhiloEmojiFirst"></span>
              <div>
                <div style="font-size: 13px; color: #fbbf24;" id="otherPhiloNameFirst"></div>
                <div style="font-size: 12px; color: #8b8b92;" id="otherPhiloQuoteFirst"></div>
              </div>
            </div>
          </div>
        </div>

        <a href="index.html" class="home-btn">
          🎮 심리/철학 시뮬레이터 경험해보기
        </a>
        
        <div class="research-card">
          <div class="research-header">
            <span class="research-icon">📊</span>
            <span class="research-label">연구 결과</span>
          </div>
          <div class="research-title" id="resultTitle"></div>
          <div class="research-desc" id="resultDesc"></div>
          <div class="research-source" id="resultSource"></div>
        </div>
        
        <!-- 책 프로모션 -->
        <div class="book-promo-card" id="bookPromoFirst" style="margin-top: 32px; padding: 20px; background: #141417; border-radius: 16px;">
          <div style="font-size: 13px; color: #8b8b92; margin-bottom: 16px; text-align: center;">📚 더 깊이 탐구하고 싶다면</div>
          <div style="display: flex; justify-content: center; gap: 20px;">
            <a href="https://litt.ly/eclipse.thinker" target="_blank" style="text-decoration: none; text-align: center;">
              <img src="book-psychology.png" alt="" style="width: 90px; height: auto; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
              <div style="font-size: 11px; color: #a1a1aa;">훔친 심리학</div>
            </a>
            <a href="https://litt.ly/eclipse.thinker" target="_blank" style="text-decoration: none; text-align: center;">
              <img src="book-philosophy.png" alt="" style="width: 90px; height: auto; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
              <div style="font-size: 11px; color: #a1a1aa;">훔친 철학</div>
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="already-done hidden" id="alreadyDone">
      <div class="already-icon">✅</div>
      <div class="already-title">오늘의 딜레마 완료!</div>
      
      <!-- 딜레마 내용 다시 보기 -->
      <div class="dilemma-card" style="margin: 20px 0;">
        <div class="dilemma-category" id="dilemmaCategoryDone"></div>
        <div class="dilemma-situation" id="dilemmaSituationDone"></div>
        <div class="dilemma-question" id="dilemmaQuestionDone"></div>
      </div>
      
      <!-- 내 선택 표시 -->
      <div class="my-choice-card" style="background: rgba(167, 139, 250, 0.1); border: 1px solid rgba(167, 139, 250, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
        <div style="font-size: 12px; color: #9580ff; margin-bottom: 8px;">✓ 나의 선택</div>
        <div style="font-size: 15px; color: #fff;" id="myChoiceTextDone"></div>
      </div>
      
      <!-- 성향 카드 (재방문자용) -->
      <div class="profile-card-wrapper" style="margin: 20px 0;">
        <div class="profile-card" id="profileCardDone">
          <div class="profile-card-content">
            <div class="profile-top-row">
              <div class="profile-badge" id="cardBadgeDone">오늘의 딜레마</div>
              <div class="profile-percent">
                <div class="percent-label">당신은</div>
                <div><span class="percent-value" id="cardPercentDone">50</span><span class="percent-suffix">%</span></div>
              </div>
            </div>
            <div class="profile-type">
              <div class="type-label">당신의 성향</div>
              <div class="type-name" id="cardTypeNameDone">-</div>
              <div class="type-desc" id="cardTypeDescDone">-</div>
            </div>
            <div class="profile-philosopher">
              <div class="philosopher-emoji" id="cardPhiloEmojiDone">🎭</div>
              <div class="philosopher-info">
                <div class="philosopher-label">비슷한 성향의 철학자</div>
                <div class="philosopher-name" id="cardPhiloNameDone">-</div>
                <div class="philosopher-desc" id="cardPhiloDescDone">-</div>
              </div>
            </div>
            <div class="profile-branding">
              <div class="branding-logo">
                <span class="branding-icon">🧠</span>
                <span class="branding-text">이클립스의 딜렘</span>
              </div>
              <div class="branding-date" id="cardDateDone"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 다른 선택지 해설 (아코디언) -->
      <div class="other-choice-section" style="margin-bottom: 20px;">
        <button class="other-choice-toggle" id="otherChoiceToggle" style="width: 100%; background: #141417; border: 1px solid #232326; border-radius: 12px; padding: 16px; color: #8b8b92; font-size: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
          <span>🔍 다른 선택을 했다면?</span>
          <span id="toggleArrow">▼</span>
        </button>
        <div class="other-choice-content hidden" id="otherChoiceContent" style="background: #141417; border: 1px solid #232326; border-top: none; border-radius: 0 0 12px 12px; padding: 16px; margin-top: -1px;">
          <div style="font-size: 14px; color: #d4d4d8; margin-bottom: 12px;" id="otherChoiceTextDone"></div>
          <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <span style="background: #232326; padding: 4px 10px; border-radius: 20px; font-size: 13px; color: #9580ff;" id="otherPercentDone"></span>
            <span style="background: #232326; padding: 4px 10px; border-radius: 20px; font-size: 13px; color: #fbbf24;" id="otherTypeDone"></span>
          </div>
          <div style="font-size: 13px; color: #a1a1aa; margin-bottom: 8px;" id="otherTypeDescDone"></div>
          <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #09090b; border-radius: 8px;">
            <span style="font-size: 24px;" id="otherPhiloEmojiDone"></span>
            <div>
              <div style="font-size: 13px; color: #fbbf24;" id="otherPhiloNameDone"></div>
              <div style="font-size: 12px; color: #8b8b92;" id="otherPhiloQuoteDone"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 연구 결과 해설 -->
      <div class="research-card" style="margin-bottom: 20px;">
        <div class="research-header">
          <span class="research-icon">📊</span>
          <span class="research-label">연구 결과</span>
        </div>
        <div class="research-title" id="resultTitleDone"></div>
        <div class="research-desc" id="resultDescDone"></div>
        <div class="research-source" id="resultSourceDone"></div>
      </div>
      
      <!-- 공유 버튼 -->
      <div class="card-actions" style="margin-bottom: 20px;">
        <button class="action-btn" id="saveImageBtnDone">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          이미지 저장
        </button>
        <button class="action-btn secondary" id="shareBtnDone">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
          공유하기
        </button>
      </div>

      <a href="index.html" class="home-btn" style="margin-bottom: 20px;">
        🎮 심리/철학 시뮬레이터 경험해보기
      </a>
      
      <div class="tomorrow-timer">
        <span>다음 딜레마까지</span>
        <span class="timer-num" id="timerDisplay">--:--:--</span>
      </div>
      
      <!-- 책 프로모션 -->
      <div class="book-promo-card" id="bookPromoDone" style="margin-top: 32px; padding: 20px; background: #141417; border-radius: 16px;">
        <div style="font-size: 13px; color: #8b8b92; margin-bottom: 16px; text-align: center;">📚 더 깊이 탐구하고 싶다면</div>
        <div style="display: flex; justify-content: center; gap: 20px;">
          <a href="https://litt.ly/eclipse.thinker" target="_blank" style="text-decoration: none; text-align: center;">
            <img src="book-psychology.png" alt="" style="width: 90px; height: auto; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
            <div style="font-size: 11px; color: #a1a1aa;">훔친 심리학</div>
          </a>
          <a href="https://litt.ly/eclipse.thinker" target="_blank" style="text-decoration: none; text-align: center;">
            <img src="book-philosophy.png" alt="" style="width: 90px; height: auto; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
            <div style="font-size: 11px; color: #a1a1aa;">훔친 철학</div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDZ-NATGNFjQ90gswfebIV-0xqhps68qJM",
      authDomain: "eclipse-mindlab.firebaseapp.com",
      projectId: "eclipse-mindlab",
      storageBucket: "eclipse-mindlab.firebasestorage.app",
      messagingSenderId: "181450990304",
      appId: "1:181450990304:web:3043d3857815249f53e685"
    };

    const firebaseApp = initializeApp(firebaseConfig);
    const auth = getAuth(firebaseApp);
    const db = getFirestore(firebaseApp);

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        signInAnonymously(auth).catch(console.error);
      }
    });

    // Firebase에 프로필 저장 함수
    function saveProfileToCloud(profile) {
      const user = auth.currentUser;
      if (user) {
        const docRef = doc(db, 'users', user.uid);
        setDoc(docRef, { ...profile, updatedAt: new Date().toISOString() }, { merge: true })
          .then(() => console.log('클라우드 저장 완료'))
          .catch(console.error);
      }
    }

    const STORAGE_KEY = 'eclipse_mindlab_daily';
    const PROFILE_KEY = 'eclipse_mindlab_profile';
    
    const dilemmas = [
      {
        category: '철학 · 시간',
        situation: '타임머신이 발명되었다.\n\n과거로 갈 수 있다. 단, 조건이 있다.\n\n과거를 바꾸는 순간, 지금의 기억은 사라진다. 새로운 타임라인의 당신이 될 뿐.\n\n10년 전으로 가서 비트코인을 산다? 부자가 된 "다른 당신"이 존재하게 된다. 하지만 지금의 당신은 사라진다.\n\n그 새로운 당신은 타임머신을 탄 기억조차 없다.',
        question: '과거를 바꾸겠는가?',
        choices: [
          { text: '바꾼다 (더 나은 내가 된다)', percent: 38, type: '결과주의자', typeDesc: '더 나은 버전의 내가 존재하는 것이 중요합니다. 지금의 기억이 사라져도, 그 "나"는 더 행복할 테니까요. 하지만 그게 정말 "당신"일까요?', philosopher: '데릭 파핏', philoEmoji: '🔄', philoQuote: '"정체성보다 연속성이 중요하다"' },
          { text: '바꾸지 않는다 (지금의 내가 사라진다)', percent: 62, type: '정체성 보존자', typeDesc: '지금의 기억, 경험, 관계가 "나"를 구성합니다. 더 나은 삶이어도 그건 다른 사람입니다. 당신은 지금의 당신을 선택했습니다.', philosopher: '존 로크', philoEmoji: '🧠', philoQuote: '"기억의 연속이 정체성이다"' }
        ],
        principle: '정체성의 연속성',
        explanation: '만약 기억이 완전히 바뀐다면, 그것은 여전히 "나"인가? 파핏은 정체성이란 환상이라 했다. 중요한 것은 심리적 연속성이다. 하지만 그 연속성마저 끊긴다면?',
        source: 'Derek Parfit, "Reasons and Persons", 1984'
      },
      {
        category: '심리 · 인지',
        situation: '부동산을 보러 갔다.\n\n중개인이 세 집을 보여준다.\n\nA: 깔끔하지만 평범한 집. 3억.\nB: 넓고 좋은데 보일러가 고장. 3억 5천.\nC: 넓고 좋고 완벽한 집. 3억 5천.\n\nB는 미끼다. 아무도 고장난 집을 사지 않는다.\n\n하지만 B가 있으면, C가 훨씬 매력적으로 보인다. "같은 가격에 완벽하잖아!"\n\n당신은 C에 끌린다.',
        question: 'C가 더 좋아 보이는가?',
        choices: [
          { text: '그렇다 (B보다 확실히 낫다)', percent: 73, type: '상대적 비교자', typeDesc: '인간은 절대적 가치를 모릅니다. 항상 비교 대상이 필요합니다. 미끼(B)가 있으면 C의 가치가 올라갑니다. 당신은 조종당하고 있습니다.', philosopher: '댄 애리얼리', philoEmoji: '🎯', philoQuote: '"우리는 비교할 때만 결정할 수 있다"' },
          { text: '아니다 (A와 비교해야지)', percent: 27, type: '절대적 평가자', typeDesc: '미끼를 무시하고 본질을 봅니다. 3억 vs 3억 5천. 5천만원 차이의 가치가 있는가? 하지만 이런 사고는 훈련이 필요합니다.', philosopher: '대니얼 카너먼', philoEmoji: '🔍', philoQuote: '"시스템2를 작동시켜라"' }
        ],
        principle: '미끼 효과',
        explanation: '이코노미스트지 실험: 웹 구독 $59, 인쇄 구독 $125, 웹+인쇄 $125. 인쇄만($125)은 미끼다. 이것이 있으면 84%가 $125를 선택한다. 없으면 68%가 $59를 선택한다.',
        source: 'Dan Ariely, "Predictably Irrational", 2008'
      },
      {
        category: '철학 · 윤리',
        situation: '당신은 의사다.\n\n말기 암 환자가 있다. 극심한 고통 속에 있다. 회복 가능성은 0%.\n\n환자가 당신에게 간청한다.\n"제발... 끝내주세요. 더 이상 못 버티겠어요."\n\n가족도 동의한다. 환자의 의지는 명확하다.\n\n당신 손에는 주사기가 있다. 고통 없이 보내줄 수 있다.\n\n하지만 법적으로 살인이다.',
        question: '주사기를 놓을 것인가?',
        choices: [
          { text: '놓는다 (환자의 의지를 존중)', percent: 54, type: '자율성 존중자', typeDesc: '내 몸에 대한 결정권은 나에게 있습니다. 존엄하게 죽을 권리도 권리입니다. 네덜란드, 벨기에, 캐나다는 이를 인정합니다.', philosopher: '피터 싱어', philoEmoji: '💉', philoQuote: '"고통 없는 죽음은 때로 자비다"' },
          { text: '놓지 않는다 (생명은 절대적)', percent: 46, type: '생명 신성론자', typeDesc: '의사의 역할은 살리는 것입니다. 한 번 허용하면 미끄러운 비탈길입니다. 노인, 장애인에 대한 압박이 시작될 수 있습니다.', philosopher: '레온 카스', philoEmoji: '⚕️', philoQuote: '"생명의 신성함을 지켜야 한다"' }
        ],
        principle: '안락사 딜레마',
        explanation: '2002년 네덜란드가 처음으로 안락사를 합법화했다. 현재 전 세계 10여 개국이 허용한다. 핵심 논쟁: 자율성 vs 생명의 신성함, 그리고 "미끄러운 비탈길" 우려.',
        source: 'Netherlands Euthanasia Act, 2002'
      },
      {
        category: '심리 · 귀인',
        situation: '회의 중 동료가 발표를 망쳤다.\n\n버벅거리고, 자료도 틀렸다. 팀장 얼굴이 굳어간다.\n\n당신은 생각한다. "역시... 그 사람은 준비를 안 해."\n\n그런데 지난주, 당신도 비슷한 실수를 했다.\n\n그때 당신은 뭐라고 생각했더라?',
        question: '그때 당신은 어떻게 생각했는가?',
        choices: [
          { text: '"오늘 컨디션이 안 좋았어"', percent: 78, type: '자기 방어자', typeDesc: '남의 실수는 성격 탓, 내 실수는 상황 탓. 인간의 보편적 편향입니다. 자존감을 지키기 위한 무의식적 방어기제입니다.', philosopher: '프리츠 하이더', philoEmoji: '🪞', philoQuote: '"귀인 이론의 아버지"' },
          { text: '"나도 준비를 못했네"', percent: 22, type: '자기 성찰자', typeDesc: '자신에게도 같은 기준을 적용합니다. 드문 성숙함입니다. 하지만 지나치면 자기 비하가 됩니다.', philosopher: '칼 로저스', philoEmoji: '🔍', philoQuote: '"자기 일치가 건강의 핵심"' }
        ],
        principle: '기본적 귀인 오류',
        explanation: '타인의 행동은 성격으로, 자신의 행동은 상황으로 설명하는 경향. "그 사람은 원래 그래" vs "나는 오늘 힘들었어". 이 편향을 아는 것만으로도 관계가 달라진다.',
        source: 'Ross, 1977 (Stanford)'
      },
      {
        category: '철학 · 정체성',
        situation: '우울증 치료제를 먹기 시작했다.\n\n효과가 좋다. 너무 좋다. 당신은 더 밝아지고, 사교적이 되고, 자신감이 넘친다.\n\n친구가 말한다. "너 요즘 완전 달라졌어. 진짜 좋아 보여!"\n\n하지만 문득 생각한다. 이게 진짜 나일까?\n\n약을 끊으면 우울한 내가 돌아온다. 약을 먹으면 밝은 내가 된다.\n\n어떤 것이 "진짜 나"인가?',
        question: '약을 먹은 내가 진짜 나인가?',
        choices: [
          { text: '그렇다 (더 나은 내가 진짜)', percent: 44, type: '기능주의자', typeDesc: '뇌의 화학작용이 바뀌면 "나"도 바뀝니다. 어차피 모든 감정은 화학물질입니다. 더 잘 기능하는 내가 더 진짜입니다.', philosopher: '피터 크레이머', philoEmoji: '💊', philoQuote: '"코스메틱 정신약리학"' },
          { text: '아니다 (본래의 내가 진짜)', percent: 56, type: '본질주의자', typeDesc: '약 없이의 내가 "자연스러운" 나입니다. 약으로 만든 성격은 마스크일 뿐입니다. 하지만... 안경 쓴 시력도 "가짜"인가요?', philosopher: '칼 엘리엇', philoEmoji: '🎭', philoQuote: '"진정성에 대한 질문"' }
        ],
        principle: '화학적 자아',
        explanation: '프로작이 등장한 후 제기된 질문. SSRI가 성격을 바꾸면, 그것은 치료인가 강화인가? 커피로 각성한 나, 술로 대담해진 나는 진짜 나인가?',
        source: 'Peter Kramer, "Listening to Prozac", 1993'
      },
      {
        category: '심리 · 손실',
        situation: '100만원을 받았다.\n\n그런데 조건이 있다.\n\nA: 50만원을 확실히 잃는다. 50만원이 남는다.\nB: 동전을 던진다. 앞면이면 100만원 전부 유지, 뒷면이면 전부 잃는다.\n\n기대값은 같다. 둘 다 평균 50만원.\n\n하지만 느낌은 다르다.',
        question: '어떤 것을 선택할 것인가?',
        choices: [
          { text: 'A: 확실히 50만원 잃기', percent: 31, type: '손실 확정자', typeDesc: '확실한 손실을 받아들입니다. 논리적으로 기대값은 같지만, 이 선택은 소수입니다.', philosopher: '에피쿠로스', philoEmoji: '📉', philoQuote: '"고통의 최소화"' },
          { text: 'B: 동전 던지기', percent: 69, type: '손실 회피자', typeDesc: '손실 상황에서는 도박을 선호합니다. "잃는 것"이 너무 고통스러워서 위험을 감수합니다. 이것이 물타기의 심리입니다.', philosopher: '대니얼 카너먼', philoEmoji: '🎰', philoQuote: '"손실은 이득보다 2배 아프다"' }
        ],
        principle: '손실 회피와 위험 추구',
        explanation: '이득 상황에서는 확실한 것을 선택하고(위험 회피), 손실 상황에서는 도박을 선택한다(위험 추구). 주식이 떨어질 때 팔지 못하고 버티는 이유다.',
        source: 'Kahneman & Tversky, Prospect Theory, 1979'
      },
      {
        category: '철학 · 존재',
        situation: '외계 문명에서 메시지가 왔다.\n\n"우리는 1000년 전 당신들을 관찰했습니다. 당신들에게 의식이 있는지 확인하고 싶습니다."\n\n그들이 묻는다: "당신은 의식이 있다는 것을 어떻게 증명할 수 있습니까?"\n\n생각해보니, 당신도 모른다. 당신이 진짜 의식이 있는지, 아니면 의식이 있다고 프로그래밍되어 있는지.',
        question: '당신은 의식이 있다고 증명할 수 있는가?',
        choices: [
          { text: '증명할 수 있다', percent: 28, type: '확신자', typeDesc: '데카르트의 답: "나는 생각한다, 고로 존재한다." 의심하는 것 자체가 의식의 증거입니다. 하지만... 그것도 프로그램일 수 있지 않나요?', philosopher: '르네 데카르트', philoEmoji: '💭', philoQuote: '"Cogito, ergo sum"' },
          { text: '증명할 수 없다', percent: 72, type: '회의론자', typeDesc: '주관적 경험은 제3자에게 전달 불가능합니다. 좀비(행동은 같지만 내면이 없는 존재)와 당신의 차이를 어떻게 증명하겠습니까?', philosopher: '데이비드 차머스', philoEmoji: '🧟', philoQuote: '"철학적 좀비"' }
        ],
        principle: '의식의 어려운 문제',
        explanation: '차머스가 제기한 "어려운 문제": 왜 물리적 과정에 주관적 경험이 수반되는가? 뇌의 뉴런 활동이 왜 "느껴지는" 것을 만들어내는가? 아무도 모른다.',
        source: 'David Chalmers, "The Hard Problem of Consciousness", 1995'
      },
      {
        category: '심리 · 집단',
        situation: '당신은 회의실에 있다.\n\n중요한 결정이 내려지려 한다. 당신은 이 결정이 잘못됐다고 생각한다.\n\n하지만 팀장, 임원, 동료들 모두 찬성한다. 분위기가 "이미 결정됨"으로 흐른다.\n\n반대 의견을 내면 분위기를 깨게 된다. "왜 혼자 튀려고 해?"라는 시선이 느껴진다.\n\n하지만 말하지 않으면, 나중에 "왜 그때 말 안 했어?"가 될 수 있다.',
        question: '반대 의견을 말할 것인가?',
        choices: [
          { text: '말한다', percent: 34, type: '이단자', typeDesc: '집단사고의 함정을 피합니다. 케네디의 피그만 침공, 챌린저 폭발 - 모두 반대 의견이 묵살된 결과입니다. 당신의 한 마디가 재앙을 막을 수 있습니다.', philosopher: '어빙 재니스', philoEmoji: '🗣️', philoQuote: '"집단사고의 희생자들"' },
          { text: '말하지 않는다', percent: 66, type: '조화 유지자', typeDesc: '팀의 화합을 중시합니다. 하지만 "화합"이 "침묵"과 같은 것은 아닙니다. 침묵은 동의로 해석됩니다.', philosopher: '솔로몬 애쉬', philoEmoji: '🤐', philoQuote: '"동조의 압력"' }
        ],
        principle: '집단사고',
        explanation: '1961년 피그만 침공 실패 후 재니스가 연구했다. 응집력 높은 집단에서 비판적 사고가 억제되는 현상. 만장일치의 환상, 자기검열, 이견자에 대한 압력이 특징이다.',
        source: 'Irving Janis, "Victims of Groupthink", 1972'
      },
      {
        category: '철학 · 무한',
        situation: '힐베르트 호텔.\n\n무한 개의 방이 있고, 모든 방에 손님이 있다.\n\n새 손님이 온다. "빈 방이 없어요."\n\n프론트: "걱정 마세요. 1번 방 손님을 2번으로, 2번을 3번으로... 모든 손님을 한 칸씩 옮기면 1번 방이 비어요."\n\n그런데 버스가 도착한다. 무한 명의 새 손님.\n\n프론트: "괜찮아요. 1번을 2번으로, 2번을 4번으로, 3번을 6번으로... 홀수 방이 무한 개 비어요."',
        question: '무한은 이해 가능한가?',
        choices: [
          { text: '논리적으로 이해된다', percent: 41, type: '수학적 사고자', typeDesc: '무한+1=무한. 무한×2=무한. 논리적으로 맞습니다. 하지만 우리 뇌는 유한한 세계를 위해 진화했습니다.', philosopher: '게오르그 칸토어', philoEmoji: '∞', philoQuote: '"무한의 아버지"' },
          { text: '직관적으로 불가능하다', percent: 59, type: '직관주의자', typeDesc: '머리로는 알겠지만 "느껴지지" 않습니다. 무한은 개념이지 경험이 아닙니다. 우리는 유한한 존재니까요.', philosopher: '레오폴트 크로네커', philoEmoji: '🧮', philoQuote: '"신이 정수를 만들었고, 나머지는 인간의 작품"' }
        ],
        principle: '힐베르트의 호텔',
        explanation: '무한의 역설적 성질을 보여주는 사고실험. "무한 - 무한 = ?"은 정의되지 않는다. 무한은 수가 아니라 개념이다. 칸토어는 무한에도 크기가 다르다는 것을 증명했다.',
        source: 'David Hilbert, 1924'
      },
      {
        category: '심리 · 자기',
        situation: '내일 중요한 시험이다.\n\n그런데 오늘 밤, 친구들이 파티에 초대한다.\n\n"내일 시험인데..." "한 시간만!"\n\n당신은 간다. 새벽 3시까지 놀았다.\n\n다음 날, 시험을 망쳤다.\n\n돌아오는 길에 생각한다. "어젯밤 파티 안 갔으면 잘 봤을 텐데..."',
        question: '왜 파티에 갔을까?',
        choices: [
          { text: '나쁜 선택을 했다', percent: 42, type: '자기 책임자', typeDesc: '솔직한 인정입니다. 파티를 선택한 것은 당신입니다. 하지만 무의식적으로 "변명"을 만든 것일 수 있습니다.', philosopher: '장폴 사르트르', philoEmoji: '⚡', philoQuote: '"인간은 자유로 선고받았다"' },
          { text: '무의식적으로 변명을 만들었다', percent: 58, type: '자기 통찰자', typeDesc: '자기 핸디캡입니다. 실패했을 때 능력 부족이 아닌 외부 요인 탓으로 돌리기 위해 스스로 장애물을 만듭니다. 자존감 보호 전략입니다.', philosopher: '스티븐 버글라스', philoEmoji: '🛡️', philoQuote: '"자기 핸디캡 전략"' }
        ],
        principle: '자기 핸디캡',
        explanation: '실패가 예상될 때, 미리 변명거리를 만드는 현상. "술 마셔서", "준비할 시간이 없어서". 자존감을 보호하지만, 실제 성장을 방해한다.',
        source: 'Berglas & Jones, 1978'
      },
      {
        category: '철학 · 언어',
        situation: '모래알 하나가 있다. 이것은 "모래더미"가 아니다.\n\n모래알 하나를 더한다. 여전히 모래더미가 아니다.\n\n계속 하나씩 더한다. 언제 "모래더미"가 되는가?\n\n10,000개? 10,001개? 정확히 몇 개에서?\n\n반대로, 모래더미에서 하나씩 빼면? 언제 모래더미가 "아니게" 되는가?',
        question: '경계는 존재하는가?',
        choices: [
          { text: '존재한다 (어딘가에 선이 있다)', percent: 23, type: '본질주의자', typeDesc: '모든 개념에는 명확한 정의가 있어야 합니다. 하지만 그 "선"을 찾아보세요. 10,000개는 더미고 9,999개는 아닌가요?', philosopher: '플라톤', philoEmoji: '📏', philoQuote: '"이데아의 세계"' },
          { text: '존재하지 않는다 (언어의 한계)', percent: 77, type: '언어 회의론자', typeDesc: '모래더미, 대머리, 젊은/늙은... 우리 언어는 모호합니다. 현실은 연속적이지만, 언어는 불연속적으로 쪼갭니다.', philosopher: '루트비히 비트겐슈타인', philoEmoji: '💬', philoQuote: '"언어의 한계가 세계의 한계"' }
        ],
        principle: '소리테스 역설',
        explanation: '고대 그리스의 역설. "대머리"는 몇 개부터인가? "키 큰 사람"은 몇 cm부터인가? 이 역설은 우리 언어와 개념의 근본적 모호함을 드러낸다.',
        source: 'Eubulides of Miletus, 기원전 4세기'
      },
      {
        category: '심리 · 행복',
        situation: '놀라운 연구 결과가 있다.\n\n복권 1등 당첨자. 그리고 사고로 하반신이 마비된 사람.\n\n1년 후 행복도를 측정했다.\n\n결과는? 거의 차이가 없었다.\n\n당첨자는 처음의 흥분이 사라졌고, 마비 환자는 새로운 삶에 적응했다.\n\n당신은 이 결과를 믿는가?',
        question: '인간은 무엇에든 적응하는가?',
        choices: [
          { text: '인간은 적응한다 (어떤 상황이든)', percent: 71, type: '적응 인정자', typeDesc: '헤도닉 트레드밀. 좋든 나쁘든 우리는 적응합니다. 승진해도, 이혼해도, 결국 "기준점"으로 돌아옵니다. 영원한 행복도, 영원한 불행도 없습니다.', philosopher: '대니얼 길버트', philoEmoji: '🔄', philoQuote: '"우리는 행복을 예측하는 데 서툴다"' },
          { text: '그래도 상황이 중요하다', percent: 29, type: '상황 중시자', typeDesc: '적응에도 한계가 있습니다. 만성 통증, 극심한 빈곤은 적응하기 어렵습니다. 하지만 대부분의 "나쁜 일"은 예상보다 덜 나쁩니다.', philosopher: '마틴 셀리그만', philoEmoji: '📊', philoQuote: '"긍정심리학의 아버지"' }
        ],
        principle: '헤도닉 적응',
        explanation: 'Brickman의 1978년 연구. 인간은 쾌락의 러닝머신 위에 있다. 더 빨리 뛰어도 제자리다. 이것을 알면 "더 많이"를 쫓는 것이 무의미해 보인다.',
        source: 'Brickman, Coates & Janoff-Bulman, 1978'
      },
      {
        category: '철학 · 미래',
        situation: '당신 앞에 상자 두 개.\n\n투명 상자: 100만원이 보인다.\n불투명 상자: 10억원이 있거나 비어있다.\n\n규칙은 간단하다. 불투명 상자만 가져가거나, 둘 다 가져갈 수 있다.\n\n문제는 예측자다. 이 예측자는 99.9% 정확하게 당신의 선택을 예측한다.\n\n"둘 다 가져갈 것"으로 예측하면 → 불투명 상자를 비워놓는다.\n"하나만 가져갈 것"으로 예측하면 → 10억원을 넣어놓는다.\n\n예측은 이미 끝났다. 상자 안은 정해져 있다.',
        question: '어떻게 할 것인가?',
        choices: [
          { text: '불투명 상자만 (10억원을 믿는다)', percent: 52, type: '기대 효용 극대화자', typeDesc: '예측자가 99.9% 맞춘다면, 하나만 가져가면 10억원이 있을 확률이 높습니다. 기대값으로는 이것이 합리적입니다.', philosopher: '로버트 노직', philoEmoji: '📦', philoQuote: '"뉴컴의 역설"' },
          { text: '둘 다 (이미 정해졌으니까)', percent: 48, type: '지배 전략 선택자', typeDesc: '상자 안은 이미 정해졌습니다. 뭐가 있든, 둘 다 가져가는 것이 항상 100만원 더 이득입니다. 과거는 바꿀 수 없으니까요.', philosopher: '로버트 오먼', philoEmoji: '🎲', philoQuote: '"게임 이론의 대가"' }
        ],
        principle: '뉴컴의 역설',
        explanation: '철학자들도 갈리는 문제. 두 접근법 모두 논리적으로 타당해 보인다. 자유의지, 인과관계, 합리성의 본질에 대한 질문을 던진다.',
        source: 'Robert Nozick, 1969'
      },
      {
        category: '심리 · 도덕',
        situation: '트롤리 문제를 기억하는가?\n\n기차가 5명을 향해 달린다. 레버를 당기면 다른 선로로 바뀌고 1명이 죽는다.\n\n85%가 레버를 당긴다고 답한다.\n\n이번엔 다리 위다. 5명을 구하려면 옆에 서 있는 사람을 밀어 떨어뜨려야 한다.\n\n결과는 똑같다. 1명 희생, 5명 구함.\n\n그런데 느낌이 다르다.',
        question: '밀 것인가?',
        choices: [
          { text: '민다 (1명 희생, 5명 구함)', percent: 12, type: '일관된 공리주의자', typeDesc: '결과는 같습니다. 1 vs 5. 레버를 당기면서 이건 안 된다는 것은 논리적으로 일관되지 않습니다.', philosopher: '피터 싱어', philoEmoji: '⚖️', philoQuote: '"결과가 중요하다"' },
          { text: '밀지 않는다 (레버는 당겼지만)', percent: 88, type: '직관적 도덕론자', typeDesc: '같은 결과인데 왜 다르게 느끼는가? "직접 손으로 미는 것"과 "레버를 당기는 것"의 심리적 거리가 다릅니다. 이것이 인간 도덕의 비일관성입니다.', philosopher: '조슈아 그린', philoEmoji: '🧠', philoQuote: '"도덕은 감정이 먼저"' }
        ],
        principle: '이중 효과 원칙',
        explanation: '의도한 해악 vs 예견된 부수적 해악. 레버는 "방향 전환"이 목적, 죽음은 부수적. 밀기는 죽음이 "수단". 같은 결과, 다른 도덕적 판단.',
        source: 'Philippa Foot, 1967 / Judith Thomson, 1985'
      },
      {
        category: '심리 · 기억',
        situation: '당신은 아름다운 휴가를 보냈다.\n\n2주간 완벽했다. 하지만 마지막 날, 최악의 일이 일어났다.\n\n비행기가 12시간 지연. 짐을 잃어버림. 음식에 탈이 남.\n\n1년 후, 이 휴가를 어떻게 기억하는가?',
        question: '좋은 휴가로 기억할 것인가?',
        choices: [
          { text: '그래도 좋은 휴가였다', percent: 31, type: '경험 자아 우세', typeDesc: '2주 중 13일이 좋았습니다. 비율로 보면 93%가 좋았습니다. 하지만 대부분의 사람들은 이렇게 기억하지 않습니다.', philosopher: '에피쿠로스', philoEmoji: '☀️', philoQuote: '"즐거움의 총합"' },
          { text: '나쁜 휴가로 기억된다', percent: 69, type: '기억 자아 우세', typeDesc: '피크-엔드 법칙. 우리는 "가장 강렬한 순간"과 "끝"으로 전체를 판단합니다. 마지막이 좋으면 전체가 좋아 보입니다.', philosopher: '대니얼 카너먼', philoEmoji: '📉', philoQuote: '"경험 자아 vs 기억 자아"' }
        ],
        principle: '피크-엔드 법칙',
        explanation: '카너먼의 연구: 대장내시경 환자들. 더 오래 아픈 시술이라도 끝이 덜 아프면 "덜 아팠다"고 기억한다. 기억이 경험을 지배한다.',
        source: 'Kahneman et al., 1993'
      },
      {
        category: '철학 · 책임',
        situation: '자율주행차 시대가 왔다.\n\n갑자기 5명이 도로에 뛰어든다. 브레이크는 이미 늦었다.\n\n선택지는 두 가지뿐.\n직진 → 5명 사망.\n핸들 → 보행자 1명 사망.\n\nAI는 어떻게 프로그래밍되어야 하는가?\n\n그리고 그 결정의 책임은 누구에게 있는가? 개발자? 회사? 탑승자? AI?',
        question: 'AI는 "적은 수를 희생"하도록 프로그래밍 되어야 하는가?',
        choices: [
          { text: '그렇다 (5명보다 1명)', percent: 76, type: '공리주의 프로그래머', typeDesc: '논리적으로 맞습니다. 하지만 "당신"이 그 1명이 될 수 있습니다. 이런 차를 사겠습니까? MIT 조사: 대부분 "그렇게 프로그래밍 되어야 한다"면서도 "그런 차는 안 산다"고 답했습니다.', philosopher: 'MIT 미디어랩', philoEmoji: '🚗', philoQuote: '"모럴 머신 프로젝트"' },
          { text: '아니다 (탑승자 보호 우선)', percent: 24, type: '탑승자 우선주의자', typeDesc: '차는 탑승자를 위한 것입니다. 내 차가 나를 희생시키도록 설계되면 누가 사겠습니까? 하지만 이것은 "돈 낸 사람이 우선"인가요?', philosopher: '패트릭 린', philoEmoji: '🛡️', philoQuote: '"로봇 윤리"' }
        ],
        principle: '알고리즘의 도덕성',
        explanation: 'MIT의 "모럴 머신"에 수백만 명이 참여했다. 문화마다 답이 달랐다. 어린이 우선, 노인 우선, 법 준수자 우선... AI 시대, 도덕을 코드로 바꿔야 한다.',
        source: 'MIT Moral Machine, Awad et al., Nature, 2018'
      },
      {
        category: '심리 · 사회',
        situation: '워싱턴 D.C. 지하철역. 출근 시간.\n\n허름한 차림의 남자가 바이올린을 연주한다.\n\n그 남자는 조슈아 벨. 세계적인 바이올리니스트다. 300억원짜리 스트라디바리우스 바이올린.\n\n공연장 티켓은 100달러가 넘는다.\n\n45분간 연주. 1,097명이 지나갔다.',
        question: '몇 명이 멈춰 섰을까?',
        choices: [
          { text: '많이 (음악은 보편적)', percent: 18, type: '낙관론자', typeDesc: '아름다운 음악은 누구나 알아본다고 믿습니다. 하지만 현실은 달랐습니다. 문맥이 인식을 지배합니다.', philosopher: '플라톤', philoEmoji: '🎵', philoQuote: '"아름다움은 진리다"' },
          { text: '거의 없다 (바빠서)', percent: 82, type: '현실주의자', typeDesc: '정답입니다. 7명만 1분 이상 멈췄습니다. 32달러를 벌었습니다. 같은 연주, 다른 맥락, 완전히 다른 가치.', philosopher: '워싱턴 포스트', philoEmoji: '🚇', philoQuote: '"맥락의 힘"' }
        ],
        principle: '맥락 효과',
        explanation: '2007년 워싱턴 포스트 실험. 퓰리처상을 받은 기사가 되었다. 우리는 "진짜 가치"를 보는가, 아니면 라벨과 맥락을 보는가?',
        source: 'Gene Weingarten, Washington Post, 2007'
      },
      {
        category: '철학 · 진정성',
        situation: '당신은 연극배우다.\n\n매일 "행복한 사람" 역할을 한다. 처음엔 연기였다.\n\n하지만 어느 순간 깨달았다. 진짜로 행복해졌다.\n\n웃는 표정을 지으니 기분이 좋아졌다. 긍정적인 대사를 하니 생각이 바뀌었다.\n\n이것은 "진짜" 행복인가, "연기"인 행복인가?',
        question: '가짜에서 시작한 행복은 진짜인가?',
        choices: [
          { text: '진짜다 (결과가 같으면)', percent: 58, type: '결과주의자', typeDesc: '안면 피드백 가설: 웃으면 정말 기분이 좋아집니다. 행동이 감정을 만듭니다. "Fake it till you make it"은 과학적으로 작동합니다.', philosopher: '윌리엄 제임스', philoEmoji: '😊', philoQuote: '"웃어서 행복한 것이다"' },
          { text: '가짜다 (시작이 연기였으니)', percent: 42, type: '진정성 추구자', typeDesc: '속에서 우러나온 것이 아니면 진짜가 아닙니다. 하지만... 어떤 감정이든 뇌의 화학작용입니다. "자연스러운" 행복은 무엇인가요?', philosopher: '장폴 사르트르', philoEmoji: '🎭', philoQuote: '"실존은 본질에 앞선다"' }
        ],
        principle: '안면 피드백 가설',
        explanation: '펜을 입에 물고(웃는 표정) 만화를 보면 더 웃긴다고 느낀다. 행동이 감정을 조절한다. 인지행동치료의 근거이기도 하다.',
        source: 'Strack, Martin & Stepper, 1988'
      },
      {
        category: '심리 · 동기',
        situation: '어린이집 실험이다.\n\n아이들에게 그림 그리기를 시켰다.\n\nA그룹: "잘 그리면 상을 줄게!"\nB그룹: 아무 말 없이 그리게 했다.\n\n며칠 뒤, 자유 시간이 주어졌다. 그림을 그려도 되고, 안 그려도 된다.\n\n어느 그룹 아이들이 더 많이 그렸을까?',
        question: '어느 그룹이 더 많이 그릴까?',
        choices: [
          { text: 'A (상을 받은 아이들)', percent: 35, type: '보상 효과 믿음', typeDesc: '보상이 동기를 강화한다고 믿습니다. 하지만 연구 결과는 반대였습니다.', philosopher: '버러스 스키너', philoEmoji: '🎁', philoQuote: '"강화 이론"' },
          { text: 'B (보상 없이 그린 아이들)', percent: 65, type: '내재 동기 이해자', typeDesc: '정답입니다. 보상을 받은 아이들은 "상 받으려고" 그린 것이 되었습니다. 상이 없으면 그릴 이유도 사라집니다. 보상이 오히려 동기를 죽입니다.', philosopher: '에드워드 데시', philoEmoji: '🎨', philoQuote: '"내재 동기의 힘"' }
        ],
        principle: '과잉정당화 효과',
        explanation: '외적 보상이 내적 동기를 파괴한다. 좋아서 하던 일에 돈을 받으면, 돈이 없으면 안 하게 된다. 이것이 창의성이 월급으로 사지 못하는 이유다.',
        source: 'Lepper, Greene & Nisbett, 1973'
      }
    ];

    let selectedChoice = null;
    let dailyData = { lastDate: null, streak: 0, history: {} };

    function loadDailyData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        dailyData = JSON.parse(saved);
        // 기존 사용자 마이그레이션: maxStreak이 없으면 현재 streak으로 초기화
        if (!dailyData.maxStreak && dailyData.streak > 0) {
          dailyData.maxStreak = dailyData.streak;
          saveDailyData();
          // 프로필에도 반영
          const ps = localStorage.getItem(PROFILE_KEY);
          if (ps) {
            const p = JSON.parse(ps);
            p.maxStreak = dailyData.maxStreak;
            localStorage.setItem(PROFILE_KEY, JSON.stringify(p));
          }
        }
      }
    }

    function saveDailyData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(dailyData));
    }

    function getTodayString() {
      const t = new Date();
      return t.getFullYear() + '-' + String(t.getMonth()+1).padStart(2,'0') + '-' + String(t.getDate()).padStart(2,'0');
    }

    function getDayOfYear() {
      const now = new Date();
      const start = new Date(now.getFullYear(), 0, 0);
      return Math.floor((now - start) / 86400000);
    }

    function getTodayDilemma() {
      return dilemmas[getDayOfYear() % dilemmas.length];
    }

    function formatDate() {
      const t = new Date();
      const days = ['일','월','화','수','목','금','토'];
      return (t.getMonth()+1) + '월 ' + t.getDate() + '일 (' + days[t.getDay()] + ')';
    }

    function formatDateShort() {
      const t = new Date();
      return t.getFullYear() + '.' + String(t.getMonth()+1).padStart(2,'0') + '.' + String(t.getDate()).padStart(2,'0');
    }

    function updateStreak() {
      const today = getTodayString();
      const y = new Date(); y.setDate(y.getDate() - 1);
      const yesterday = y.getFullYear() + '-' + String(y.getMonth()+1).padStart(2,'0') + '-' + String(y.getDate()).padStart(2,'0');
      if (dailyData.lastDate !== today && dailyData.lastDate !== yesterday) {
        dailyData.streak = 0;
        saveDailyData();
      }
    }

    function getTimeUntilMidnight() {
      const now = new Date();
      const mid = new Date(now); mid.setHours(24,0,0,0);
      return mid - now;
    }

    function formatTime(ms) {
      const h = Math.floor(ms/3600000);
      const m = Math.floor((ms%3600000)/60000);
      const s = Math.floor((ms%60000)/1000);
      return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }

    function startTimer() {
      setInterval(() => {
        document.getElementById('timerDisplay').textContent = formatTime(getTimeUntilMidnight());
      }, 1000);
    }

    function init() {
      loadDailyData();
      updateStreak();
      document.getElementById('dateDisplay').textContent = formatDate();
      
      const streakCard = document.getElementById('streakCard');
      if (dailyData.streak > 0) {
        document.getElementById('streakNum').textContent = dailyData.streak;
        streakCard.style.display = 'flex';
      }
      
      const today = getTodayString();
      if (dailyData.history[today] !== undefined) {
        showAlreadyDone(dailyData.history[today]);
        return;
      }
      
      renderDilemma(getTodayDilemma());
    }

    function showAlreadyDone(idx) {
      const dilemma = getTodayDilemma();
      const choice = dilemma.choices[idx];
      const otherIdx = idx === 0 ? 1 : 0;
      const otherChoice = dilemma.choices[otherIdx];
      
      document.getElementById('mainContent').classList.add('hidden');
      document.getElementById('alreadyDone').classList.remove('hidden');
      
      // 딜레마 내용 채우기
      document.getElementById('dilemmaCategoryDone').textContent = dilemma.category;
      document.getElementById('dilemmaSituationDone').textContent = dilemma.situation;
      document.getElementById('dilemmaQuestionDone').textContent = dilemma.question;
      
      // 내 선택 표시
      document.getElementById('myChoiceTextDone').textContent = choice.text;
      
      // 성향 카드 데이터 채우기
      document.getElementById('cardBadgeDone').textContent = dilemma.category;
      document.getElementById('cardPercentDone').textContent = choice.percent;
      document.getElementById('cardTypeNameDone').textContent = choice.type;
      document.getElementById('cardTypeDescDone').textContent = choice.typeDesc;
      document.getElementById('cardPhiloEmojiDone').textContent = choice.philoEmoji;
      document.getElementById('cardPhiloNameDone').textContent = choice.philosopher;
      document.getElementById('cardPhiloDescDone').textContent = choice.philoQuote;
      document.getElementById('cardDateDone').textContent = formatDateShort();
      
      // 다른 선택지 해설 채우기
      document.getElementById('otherChoiceTextDone').textContent = otherChoice.text;
      document.getElementById('otherPercentDone').textContent = otherChoice.percent + '%가 선택';
      document.getElementById('otherTypeDone').textContent = otherChoice.type;
      document.getElementById('otherTypeDescDone').textContent = otherChoice.typeDesc;
      document.getElementById('otherPhiloEmojiDone').textContent = otherChoice.philoEmoji;
      document.getElementById('otherPhiloNameDone').textContent = otherChoice.philosopher;
      document.getElementById('otherPhiloQuoteDone').textContent = otherChoice.philoQuote;
      
      // 연구 결과 해설 채우기
      document.getElementById('resultTitleDone').textContent = dilemma.principle;
      document.getElementById('resultDescDone').textContent = dilemma.explanation;
      document.getElementById('resultSourceDone').textContent = '출처: ' + dilemma.source;
      
      // 아코디언 토글
      const toggleBtn = document.getElementById('otherChoiceToggle');
      const toggleContent = document.getElementById('otherChoiceContent');
      const toggleArrow = document.getElementById('toggleArrow');
      
      toggleBtn.addEventListener('click', () => {
        toggleContent.classList.toggle('hidden');
        toggleArrow.textContent = toggleContent.classList.contains('hidden') ? '▼' : '▲';
      });
      
      // 버튼 이벤트
      document.getElementById('saveImageBtnDone').addEventListener('click', () => saveImageDone(idx));
      document.getElementById('shareBtnDone').addEventListener('click', () => shareResultDone(idx));
      
      startTimer();
    }
    
    function saveImageDone(idx) {
      const card = document.getElementById('profileCardDone');
      const btn = document.getElementById('saveImageBtnDone');
      btn.innerHTML = '저장 중...';
      
      html2canvas(card, { backgroundColor: '#09090b', scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'dilem-' + formatDateShort() + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        btn.classList.add('success');
        btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 저장 완료!';
        setTimeout(() => {
          btn.classList.remove('success');
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> 이미지 저장';
        }, 2000);
      });
    }
    
    function shareResultDone(idx) {
      const d = getTodayDilemma();
      const c = d.choices[idx];
      const text = '🤔 오늘의 딜레마\n\n"' + d.question + '"\n\n나의 선택 → ' + c.type + '\n(' + c.percent + '%가 같은 선택)\n\n비슷한 철학자: ' + c.philosopher + '\n' + c.philoQuote + '\n\n당신의 선택은?';
      
      if (navigator.share) {
        navigator.share({ title: '오늘의 딜레마', text: text, url: 'https://eclipse-mindlab.github.io/mindlab/daily.html' }).catch(() => {});
      } else {
        navigator.clipboard.writeText(text + '\nhttps://eclipse-mindlab.github.io/mindlab/daily.html').then(() => {
          const btn = document.getElementById('shareBtnDone');
          btn.classList.add('success');
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 복사됨!';
          setTimeout(() => {
            btn.classList.remove('success');
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg> 공유하기';
          }, 2000);
        });
      }
    }

    function renderDilemma(d) {
      document.getElementById('dilemmaCategory').textContent = d.category;
      document.getElementById('dilemmaSituation').textContent = d.situation;
      document.getElementById('dilemmaQuestion').textContent = d.question;
      
      const el = document.getElementById('choices');
      el.innerHTML = d.choices.map((c, i) => 
        '<button class="choice-btn" data-index="'+i+'"><div class="choice-content"><span class="choice-text">'+c.text+'</span><div class="choice-stats"><span class="stat-percent">'+c.percent+'%</span><div class="stat-bar"><div class="stat-fill" style="width:0%"></div></div></div></div></button>'
      ).join('');
      
      el.querySelectorAll('.choice-btn').forEach(btn => {
        btn.addEventListener('click', () => handleChoice(parseInt(btn.dataset.index)));
      });
    }

    function handleChoice(index) {
      if (selectedChoice !== null) return;
      const today = getTodayString();
      if (dailyData.history[today] !== undefined) return;
      
      selectedChoice = index;
      const dilemma = getTodayDilemma();
      
      const y = new Date(); y.setDate(y.getDate() - 1);
      const yesterday = y.getFullYear() + '-' + String(y.getMonth()+1).padStart(2,'0') + '-' + String(y.getDate()).padStart(2,'0');
      
      if (dailyData.lastDate === yesterday) dailyData.streak += 1;
      else if (dailyData.lastDate !== today) dailyData.streak = 1;
      
      // 최대 스트릭 갱신
      if (!dailyData.maxStreak || dailyData.streak > dailyData.maxStreak) {
        dailyData.maxStreak = dailyData.streak;
      }
      
      dailyData.history[today] = index;
      dailyData.lastDate = today;
      saveDailyData();
      
      // 프로필 처리 - 없으면 익명으로 생성
      let ps = localStorage.getItem(PROFILE_KEY);
      let p;
      if (ps) {
        p = JSON.parse(ps);
      } else {
        p = { name: '익명 탐험가', level: 1, exp: 0, cleared: [], principles: [] };
      }
      p.exp = (p.exp || 0) + 10;
      p.maxStreak = dailyData.maxStreak; // 프로필에도 최대 스트릭 저장
      const need = (p.level || 1) * 100;
      while (p.exp >= need) { p.exp -= need; p.level = (p.level || 1) + 1; }
      localStorage.setItem(PROFILE_KEY, JSON.stringify(p));
      saveProfileToCloud(p); // Firebase 저장
      
      document.getElementById('streakNum').textContent = dailyData.streak;
      document.getElementById('streakCard').style.display = 'flex';
      
      document.querySelectorAll('.choice-btn').forEach((btn, i) => {
        btn.classList.add('revealed');
        if (i === index) btn.classList.add('selected');
        btn.querySelector('.choice-stats').classList.add('show');
        setTimeout(() => {
          btn.querySelector('.stat-fill').style.width = dilemma.choices[i].percent + '%';
        }, 100);
      });
      
      const c = dilemma.choices[index];
      const otherIdx = index === 0 ? 1 : 0;
      const otherChoice = dilemma.choices[otherIdx];
      
      document.getElementById('cardBadge').textContent = dilemma.category;
      document.getElementById('cardPercent').textContent = c.percent;
      document.getElementById('cardTypeName').textContent = c.type;
      document.getElementById('cardTypeDesc').textContent = c.typeDesc;
      document.getElementById('cardPhiloEmoji').textContent = c.philoEmoji;
      document.getElementById('cardPhiloName').textContent = c.philosopher;
      document.getElementById('cardPhiloDesc').textContent = c.philoQuote;
      document.getElementById('cardDate').textContent = formatDateShort();
      
      // 다른 선택지 해설 채우기
      document.getElementById('otherChoiceTextFirst').textContent = otherChoice.text;
      document.getElementById('otherPercentFirst').textContent = otherChoice.percent + '%가 선택';
      document.getElementById('otherTypeFirst').textContent = otherChoice.type;
      document.getElementById('otherTypeDescFirst').textContent = otherChoice.typeDesc;
      document.getElementById('otherPhiloEmojiFirst').textContent = otherChoice.philoEmoji;
      document.getElementById('otherPhiloNameFirst').textContent = otherChoice.philosopher;
      document.getElementById('otherPhiloQuoteFirst').textContent = otherChoice.philoQuote;
      
      // 아코디언 토글
      const toggleBtnFirst = document.getElementById('otherChoiceToggleFirst');
      const toggleContentFirst = document.getElementById('otherChoiceContentFirst');
      const toggleArrowFirst = document.getElementById('toggleArrowFirst');
      
      toggleBtnFirst.addEventListener('click', () => {
        toggleContentFirst.classList.toggle('hidden');
        toggleArrowFirst.textContent = toggleContentFirst.classList.contains('hidden') ? '▼' : '▲';
      });
      
      document.getElementById('resultTitle').textContent = dilemma.principle;
      document.getElementById('resultDesc').textContent = dilemma.explanation;
      document.getElementById('resultSource').textContent = '📚 ' + dilemma.source;
      
      setTimeout(() => {
        document.getElementById('resultSection').classList.add('show');
        document.getElementById('saveImageBtn').addEventListener('click', saveImage);
        document.getElementById('shareBtn').addEventListener('click', shareResult);
      }, 600);
    }

    function saveImage() {
      const card = document.getElementById('profileCard');
      const btn = document.getElementById('saveImageBtn');
      btn.innerHTML = '저장 중...';
      
      html2canvas(card, { backgroundColor: '#09090b', scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'dilem-' + formatDateShort() + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        btn.classList.add('success');
        btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 저장 완료!';
        setTimeout(() => {
          btn.classList.remove('success');
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> 이미지 저장';
        }, 2000);
      });
    }

    function shareResult() {
      const d = getTodayDilemma();
      const c = d.choices[selectedChoice];
      const text = '🤔 오늘의 딜레마\n\n"' + d.question + '"\n\n나의 선택 → ' + c.type + '\n(' + c.percent + '%가 같은 선택)\n\n비슷한 철학자: ' + c.philosopher + '\n' + c.philoQuote + '\n\n당신의 선택은?';
      
      if (navigator.share) {
        navigator.share({ title: '오늘의 딜레마', text: text, url: 'https://eclipse-mindlab.github.io/mindlab/daily.html' }).catch(() => {});
      } else {
        navigator.clipboard.writeText(text + '\nhttps://eclipse-mindlab.github.io/mindlab/daily.html').then(() => {
          const btn = document.getElementById('shareBtn');
          btn.classList.add('success');
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> 복사됨!';
          setTimeout(() => {
            btn.classList.remove('success');
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg> 공유하기';
          }, 2000);
        });
      }
    }

    init();
  </script>
</body>
</html>
